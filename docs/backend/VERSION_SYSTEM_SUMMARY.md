# ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿå®æ–½æ€»ç»“

## ğŸ“… å®æ–½æ—¥æœŸ
**2025-11-03**

---

## ğŸ¯ é—®é¢˜æè¿°

### æ—§ç³»ç»Ÿçš„é—®é¢˜

1. **ç‰ˆæœ¬æ··ä¹±** - 14ä¸ªä¸åŒæ ¼å¼çš„JARæ–‡ä»¶å †ç§¯ï¼š
   - `get_jobs-v2.0.1-20251103_184454.jar` ï¼ˆæ—¶é—´æˆ³æ ¼å¼ï¼‰
   - `get_jobs-v20251102_auth_fix.jar` ï¼ˆåŠŸèƒ½æ ‡ç­¾æ ¼å¼ï¼‰
   - `get_jobs-v2.5.0-redis-monitoring.jar` ï¼ˆåŠŸèƒ½æ ‡ç­¾æ ¼å¼ï¼‰
   - `get_jobs-v2.0.2.jar` åˆ° `get_jobs-v2.0.8.jar` ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰

2. **æ— æ³•è¿½è¸ª** - ä¸çŸ¥é“å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªç‰ˆæœ¬
3. **æ‰‹åŠ¨ç®¡ç†** - ç‰ˆæœ¬å·æ‰‹åŠ¨ç»´æŠ¤ï¼Œå®¹æ˜“å‡ºé”™
4. **ç£ç›˜æµªè´¹** - 14ä¸ªç‰ˆæœ¬å ç”¨çº¦4.2GBç©ºé—´
5. **éƒ¨ç½²é£é™©** - æ²¡æœ‰è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå®¹æ˜“å‡ºé”™

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ç»Ÿä¸€ç‰ˆæœ¬è§„èŒƒ

#### è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
```
æ ¼å¼ï¼šMAJOR.MINOR.PATCH
ç¤ºä¾‹ï¼š2.2.0
```

#### JARå‘½åè§„èŒƒ
```
æ ¼å¼ï¼šget_jobs-v{VERSION}.jar
ç¤ºä¾‹ï¼šget_jobs-v2.2.0.jar
```

#### Gitä¿¡æ¯è¿½è¸ª
- Git SHAã€åˆ†æ”¯ã€æ„å»ºæ—¶é—´ç­‰ä¿¡æ¯å­˜å‚¨åœ¨jarå†…çš„`git.properties`
- é€šè¿‡ç‰ˆæœ¬APIå®æ—¶æŸ¥è¯¢
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—

---

### 2. è‡ªåŠ¨åŒ–å·¥å…·é“¾

| å·¥å…· | åŠŸèƒ½ | è·¯å¾„ |
|-----|------|------|
| `build-backend.sh` | è‡ªåŠ¨åŒ–æ„å»º | `/root/zhitoujianli/scripts/` |
| `deploy-backend.sh` | æ™ºèƒ½éƒ¨ç½²ï¼ˆå¤‡ä»½+å¥åº·æ£€æŸ¥+å›æ»šï¼‰ | `/root/zhitoujianli/scripts/` |
| `cleanup-old-versions.sh` | æ¸…ç†æ—§ç‰ˆæœ¬ | `/root/zhitoujianli/scripts/` |
| `get-current-version.sh` | ç‰ˆæœ¬æŸ¥è¯¢ | `/root/zhitoujianli/scripts/` |

---

### 3. ç‰ˆæœ¬è¿½è¸ªAPI

#### ç«¯ç‚¹
- `GET /api/version` - å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
- `GET /api/version/short` - ç®€åŒ–ç‰ˆæœ¬ä¿¡æ¯
- `GET /api/version/health` - å¥åº·æ£€æŸ¥+ç‰ˆæœ¬

#### å“åº”ç¤ºä¾‹
```json
{
  "version": "2.2.0",
  "gitSha": "16ebf8c",
  "gitBranch": "main",
  "buildTime": "2025-11-03T19:21:41+0800",
  "commitTime": "2025-10-27T11:55:04+0800",
  "commitMessage": "refactor: åˆ é™¤æµ‹è¯•æ¨¡å—å¹¶ä¿®å¤ä»£ç è´¨é‡é—®é¢˜",
  "uptime": "2h 15m 30s",
  "javaVersion": "21.0.8",
  "springVersion": "3.2.0",
  "osName": "Linux",
  "osVersion": "6.8.0-55-generic"
}
```

---

### 4. æŠ€æœ¯å®ç°

#### Mavené…ç½®ï¼ˆpom.xmlï¼‰
```xml
<project>
    <version>2.2.0</version>

    <build>
        <finalName>get_jobs-v${project.version}</finalName>

        <plugins>
            <!-- Git Commit ID Plugin -->
            <plugin>
                <groupId>io.github.git-commit-id</groupId>
                <artifactId>git-commit-id-maven-plugin</artifactId>
                <version>6.0.0</version>
                <!-- ç”Ÿæˆgit.properties -->
            </plugin>
        </plugins>
    </build>
</project>
```

#### ç‰ˆæœ¬ä¿¡æ¯å·¥å…·ç±»
- `VersionInfo.java` - è¯»å–git.properties
- `VersionController.java` - æš´éœ²ç‰ˆæœ¬API
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è®°å½•ç‰ˆæœ¬ä¿¡æ¯åˆ°æ—¥å¿—

#### Spring Securityé…ç½®
- ç‰ˆæœ¬APIè®¾ä¸ºå…¬å¼€è®¿é—®ï¼ˆ`/api/version/**`ï¼‰
- æ— éœ€è®¤è¯å³å¯æŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯

---

## ğŸ“Š å®æ–½æˆæœ

### Beforeï¼ˆå®æ–½å‰ï¼‰
```
âŒ 14ä¸ªç‰ˆæœ¬æ··ä¹±å †ç§¯
âŒ å ç”¨4.2GBç£ç›˜ç©ºé—´
âŒ æ— æ³•è¿½è¸ªå½“å‰ç‰ˆæœ¬
âŒ æ‰‹åŠ¨æ„å»ºå’Œéƒ¨ç½²
âŒ æ²¡æœ‰å›æ»šæœºåˆ¶
âŒ æ²¡æœ‰ç‰ˆæœ¬API
```

### Afterï¼ˆå®æ–½åï¼‰
```
âœ… ç»Ÿä¸€è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ
âœ… ä¿ç•™3ä¸ªæœ€æ–°ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
âœ… å®æ—¶ç‰ˆæœ¬è¿½è¸ªAPI
âœ… å…¨è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²
âœ… è‡ªåŠ¨å¤‡ä»½å’Œå›æ»š
âœ… ç‰ˆæœ¬ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

#### åç«¯ä»£ç 
- `src/main/java/com/superxiang/controller/VersionController.java` - ç‰ˆæœ¬APIæ§åˆ¶å™¨
- `src/main/java/com/superxiang/utils/VersionInfo.java` - ç‰ˆæœ¬ä¿¡æ¯å·¥å…·ç±»

#### è‡ªåŠ¨åŒ–è„šæœ¬
- `/root/zhitoujianli/scripts/build-backend.sh` - æ„å»ºè„šæœ¬
- `/root/zhitoujianli/scripts/deploy-backend.sh` - éƒ¨ç½²è„šæœ¬
- `/root/zhitoujianli/scripts/cleanup-old-versions.sh` - æ¸…ç†è„šæœ¬
- `/root/zhitoujianli/scripts/get-current-version.sh` - ç‰ˆæœ¬æŸ¥è¯¢è„šæœ¬

#### æ–‡æ¡£
- `/root/zhitoujianli/docs/backend/VERSION_MANAGEMENT.md` - å®Œæ•´ç‰ˆæœ¬ç®¡ç†è§„èŒƒ
- `/root/zhitoujianli/docs/backend/VERSION_QUICK_REFERENCE.md` - å¿«é€Ÿå‚è€ƒæŒ‡å—
- `/root/zhitoujianli/docs/backend/VERSION_SYSTEM_SUMMARY.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- `backend/get_jobs/pom.xml` - æ·»åŠ Gitæ’ä»¶å’Œç‰ˆæœ¬é…ç½®
- `src/main/java/com/superxiang/WebApplication.java` - å¯åŠ¨æ—¶è®°å½•ç‰ˆæœ¬ä¿¡æ¯
- `src/main/java/config/SimpleSecurityConfig.java` - ç‰ˆæœ¬APIå…¬å¼€è®¿é—®

---

## ğŸ”§ æ—¥å¸¸ä½¿ç”¨

### å¼€å‘æµç¨‹

```bash
# 1. ä¿®æ”¹ä»£ç 
vim backend/get_jobs/src/main/java/...

# 2. æ›´æ–°ç‰ˆæœ¬å·
vim backend/get_jobs/pom.xml

# 3. æäº¤ä»£ç 
git commit -m "fix(xxx): ä¿®å¤é—®é¢˜"

# 4. æ„å»º
./scripts/build-backend.sh

# 5. éƒ¨ç½²
./scripts/deploy-backend.sh

# 6. éªŒè¯
./scripts/get-current-version.sh quick
```

### ç‰ˆæœ¬æŸ¥è¯¢

```bash
# å¿«é€Ÿæ£€æŸ¥
./scripts/get-current-version.sh quick
# è¾“å‡ºï¼šâœ“ æœåŠ¡è¿è¡Œä¸­ - ç‰ˆæœ¬: 2.2.0-16ebf8c

# APIæŸ¥è¯¢
curl http://localhost:8080/api/version | jq '.'
```

### æ¸…ç†ç»´æŠ¤

```bash
# æ‰‹åŠ¨æ¸…ç†
./scripts/cleanup-old-versions.sh 3

# å®šæ—¶æ¸…ç†ï¼ˆcrontabï¼‰
0 3 * * 0 /root/zhitoujianli/scripts/cleanup-old-versions.sh 3
```

---

## ğŸ“ æœ€ä½³å®è·µ

### âœ… DOï¼ˆæ¨èï¼‰

1. **æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½æ›´æ–°ç‰ˆæœ¬å·**
   - Bugä¿®å¤ï¼šå¢åŠ PATCHï¼ˆ2.2.0 â†’ 2.2.1ï¼‰
   - æ–°åŠŸèƒ½ï¼šå¢åŠ MINORï¼ˆ2.2.1 â†’ 2.3.0ï¼‰
   - ç ´åæ€§å˜æ›´ï¼šå¢åŠ MAJORï¼ˆ2.3.0 â†’ 3.0.0ï¼‰

2. **ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬**
   - ä¸è¦æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶
   - ä¸è¦æ‰‹åŠ¨é‡å¯æœåŠ¡
   - è®©è„šæœ¬å¤„ç†ä¸€åˆ‡

3. **å…ˆæäº¤å†æ„å»º**
   - Git SHAæ˜¯ç‰ˆæœ¬è¿½è¸ªçš„å…³é”®
   - ç¡®ä¿ä»£ç å¯è¿½æº¯

4. **å®šæœŸæ¸…ç†æ—§ç‰ˆæœ¬**
   - èŠ‚çœç£ç›˜ç©ºé—´
   - ä¿æŒç¯å¢ƒæ•´æ´

5. **éƒ¨ç½²å‰å…ˆæµ‹è¯•**
   - åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - æŸ¥çœ‹æ„å»ºæ—¥å¿—
   - ç¡®è®¤ç‰ˆæœ¬å·æ­£ç¡®

### âŒ DON'Tï¼ˆç¦æ­¢ï¼‰

1. **âŒ æ‰‹åŠ¨æ“ä½œæ–‡ä»¶**
   ```bash
   # é”™è¯¯ç¤ºä¾‹
   cp target/get_jobs.jar /opt/zhitoujianli/backend/
   ```

2. **âŒ ä¸æ›´æ–°ç‰ˆæœ¬å·å°±æ„å»º**
   ```bash
   # ä¼šå¯¼è‡´ç‰ˆæœ¬æ··æ·†
   ```

3. **âŒ è·³è¿‡å¥åº·æ£€æŸ¥**
   ```bash
   # å¯èƒ½éƒ¨ç½²å¤±è´¥ä½†æœªå‘ç°
   systemctl restart zhitoujianli-backend
   ```

4. **âŒ æ‰‹åŠ¨åˆ é™¤æ—§ç‰ˆæœ¬**
   ```bash
   # å¯èƒ½è¯¯åˆ å½“å‰è¿è¡Œç‰ˆæœ¬
   rm /opt/zhitoujianli/backend/get_jobs-*.jar
   ```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ„å»ºæ—¶é—´
- Maven clean package: ~20ç§’
- Gitä¿¡æ¯æå–: <1ç§’
- æ€»æ„å»ºæ—¶é—´: ~20ç§’

### éƒ¨ç½²æ—¶é—´
- å¤‡ä»½å½“å‰ç‰ˆæœ¬: <1ç§’
- æ›´æ–°ç¬¦å·é“¾æ¥: <1ç§’
- æœåŠ¡é‡å¯: ~10ç§’
- å¥åº·æ£€æŸ¥: ~5ç§’
- æ€»éƒ¨ç½²æ—¶é—´: ~16ç§’

### å­˜å‚¨ç©ºé—´
- å•ä¸ªJARå¤§å°: ~304MB
- ä¿ç•™3ä¸ªç‰ˆæœ¬: ~900MB
- å¤‡ä»½ç›®å½•: ~600MBï¼ˆ2ä¸ªå¤‡ä»½ï¼‰
- æ€»å ç”¨: ~1.5GBï¼ˆç›¸æ¯”ä¹‹å‰çš„4.2GBèŠ‚çœäº†64%ï¼‰

---

## ğŸ”® æœªæ¥æ”¹è¿›

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

1. **é›†æˆåˆ°CI/CD**
   - GitHub Actionsè‡ªåŠ¨æ„å»º
   - è‡ªåŠ¨åŒ–æµ‹è¯•
   - è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

2. **ç‰ˆæœ¬ç›‘æ§å‘Šè­¦**
   - ç‰ˆæœ¬å˜æ›´é€šçŸ¥
   - éƒ¨ç½²æˆåŠŸ/å¤±è´¥å‘Šè­¦
   - PrometheusæŒ‡æ ‡é›†æˆ

3. **æ›´è¯¦ç»†çš„å¥åº·æ£€æŸ¥**
   - æ•°æ®åº“è¿æ¥æ£€æŸ¥
   - Redisè¿æ¥æ£€æŸ¥
   - ç¬¬ä¸‰æ–¹æœåŠ¡æ£€æŸ¥

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰

1. **å¤šç¯å¢ƒç‰ˆæœ¬ç®¡ç†**
   - å¼€å‘ç¯å¢ƒ
   - æµ‹è¯•ç¯å¢ƒ
   - ç”Ÿäº§ç¯å¢ƒ
   - ç‰ˆæœ¬éš”ç¦»å’Œè¿½è¸ª

2. **ç‰ˆæœ¬å¯¹æ¯”å·¥å…·**
   - æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚
   - æ˜¾ç¤ºGitæäº¤å†å²
   - ç”Ÿæˆå˜æ›´æ—¥å¿—

3. **å‰ç«¯ç‰ˆæœ¬ç®¡ç†**
   - å‰ç«¯ç‰ˆæœ¬å·è§„èŒƒ
   - å‰ç«¯ç‰ˆæœ¬API
   - å‰åç«¯ç‰ˆæœ¬å¯¹åº”å…³ç³»

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰

1. **é‡‘ä¸é›€å‘å¸ƒ**
   - ç°åº¦å‘å¸ƒç­–ç•¥
   - æµé‡åˆ‡æ¢
   - è‡ªåŠ¨å›æ»š

2. **ç‰ˆæœ¬å®¡è®¡**
   - å®Œæ•´çš„éƒ¨ç½²å†å²
   - å˜æ›´è¿½è¸ª
   - åˆè§„æ€§æŠ¥å‘Š

3. **æ€§èƒ½åˆ†æ**
   - ä¸åŒç‰ˆæœ¬æ€§èƒ½å¯¹æ¯”
   - èµ„æºä½¿ç”¨åˆ†æ
   - æ€§èƒ½å›å½’æ£€æµ‹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ç‰ˆæœ¬ç®¡ç†è§„èŒƒ](VERSION_MANAGEMENT.md)
- [å¿«é€Ÿå‚è€ƒæŒ‡å—](VERSION_QUICK_REFERENCE.md)
- [éƒ¨ç½²æŒ‡å—](../deployment/DEPLOYMENT_GUIDE.md)

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ™ºæŠ•ç®€å†å›¢é˜Ÿå¯¹ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„æ”¯æŒå’Œåé¦ˆã€‚

---

**ç»´æŠ¤è€…ï¼š** ZhiTouJianLi Team
**åˆ›å»ºæ—¥æœŸï¼š** 2025-11-03
**æœ€åæ›´æ–°ï¼š** 2025-11-03
**ç‰ˆæœ¬ï¼š** 1.0.0





