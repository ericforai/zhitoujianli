#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œé¢„æäº¤æ£€æŸ¥ï¼ˆç±»å‹æ£€æŸ¥ã€Lintã€æ ¼å¼æ ¡éªŒã€åˆå¹¶å†²çªæ ‡è®°æ£€æµ‹ã€é—ç•™ç›®å½•æ£€æµ‹ï¼‰..."

# åˆå¹¶å†²çªæ ‡è®°æ£€æµ‹
if git diff --cached | grep -E '^(<<<<<<<|=======|>>>>>>>)( .*)?$' > /dev/null; then
  echo "âŒ æ£€æµ‹åˆ°åˆå¹¶å†²çªæ ‡è®°ï¼Œè¯·å…ˆè§£å†³å†²çªåå†æäº¤ã€‚"
  exit 1
fi

# é—ç•™ç›®å½•æ£€æµ‹ï¼ˆé˜»æ­¢æäº¤ï¼‰
bash ./scripts/check-legacy-sources.sh || exit 1

# å‰ç«¯ä»£ç è´¨é‡æ£€æŸ¥
cd frontend || exit 1
npm run type-check || exit 1
npm run lint:check || exit 1
npm run format:check || exit 1

echo "âœ… é¢„æäº¤æ£€æŸ¥é€šè¿‡"

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
echo "ğŸ” è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥..."

# å‰ç«¯ä»£ç æ£€æŸ¥
if [ -d "frontend" ]; then
  echo "ğŸ“± æ£€æŸ¥å‰ç«¯ä»£ç ..."
  cd frontend

  # ç±»å‹æ£€æŸ¥
  echo "ğŸ”§ è¿è¡ŒTypeScriptç±»å‹æ£€æŸ¥..."
  npm run type-check

  # ESLintæ£€æŸ¥
  echo "ğŸ“ è¿è¡ŒESLintæ£€æŸ¥..."
  npm run lint:check

  # Prettieræ ¼å¼æ£€æŸ¥
  echo "ğŸ’… è¿è¡ŒPrettieræ ¼å¼æ£€æŸ¥..."
  npm run format:check

  cd ..
fi

# åç«¯ä»£ç æ£€æŸ¥ï¼ˆå·²ç¦ç”¨æµ‹è¯•ï¼‰
# åªåœ¨æœ‰ Java æ–‡ä»¶è¢«ä¿®æ”¹æ—¶æ‰è¿è¡Œ
JAVA_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$' || true)

if [ -n "$JAVA_FILES" ] && [ -d "backend/get_jobs" ]; then
  echo "âš™ï¸ æ£€æŸ¥åç«¯ä»£ç ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰..."
  echo "ğŸ“ æ£€æµ‹åˆ° Java æ–‡ä»¶æ”¹åŠ¨ï¼Œè¿è¡Œä»£ç è´¨é‡æ£€æŸ¥..."
  cd backend/get_jobs

  # Checkstyleæ£€æŸ¥
  echo "ğŸ“‹ è¿è¡ŒCheckstyleæ£€æŸ¥..."
  mvn checkstyle:check

  # SpotBugsæ£€æŸ¥
  echo "ğŸ› è¿è¡ŒSpotBugsæ£€æŸ¥..."
  mvn spotbugs:check

  # PMDæ£€æŸ¥
  echo "ğŸ” è¿è¡ŒPMDæ£€æŸ¥..."
  mvn pmd:check

  cd ../..
elif [ -d "backend/get_jobs" ]; then
  echo "âš™ï¸ æœªæ£€æµ‹åˆ° Java æ–‡ä»¶æ”¹åŠ¨ï¼Œè·³è¿‡åç«¯ä»£ç æ£€æŸ¥"
fi

echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆï¼"
