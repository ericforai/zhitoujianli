# å¯ç”¨æ€§å‘Šè­¦è§„åˆ™
# ç›‘æ§æœåŠ¡å®•æœºã€å¥åº·æ£€æŸ¥å¤±è´¥ç­‰

groups:
  - name: availability
    interval: 30s
    rules:
      # æœåŠ¡å®•æœº
      - alert: ServiceDown
        expr: up{job="zhitoujianli-backend"} == 0
        for: 1m
        labels:
          severity: critical
          category: availability
          team: ops
        annotations:
          summary: "ğŸš¨ åç«¯æœåŠ¡å®•æœºï¼"
          description: "æ™ºæŠ•ç®€å†åç«¯æœåŠ¡å·²åœæ­¢å“åº”è¶…è¿‡1åˆ†é’Ÿ"
          action: "ç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼šsystemctl status zhitoujianli-backend"
          runbook: "https://docs.zhitoujianli.com/runbook/service-down"

      # å¥åº·æ£€æŸ¥å¤±è´¥
      - alert: HealthCheckFailed
        expr: up{job="zhitoujianli-backend"} == 1 and (application_ready_status{job="zhitoujianli-backend"} == 0 or application_live_status{job="zhitoujianli-backend"} == 0)
        for: 3m
        labels:
          severity: warning
          category: availability
        annotations:
          summary: "æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥"
          description: "æœåŠ¡è¿è¡Œä¸­ä½†å¥åº·æ£€æŸ¥å¤±è´¥"
          action: "æ£€æŸ¥/actuator/healthç«¯ç‚¹å’Œä¾èµ–æœåŠ¡çŠ¶æ€"

      # HTTPè¯·æ±‚æˆåŠŸç‡ä½
      - alert: LowHTTPSuccessRate
        expr: |
          (
            sum(rate(http_server_requests_seconds_count{status=~"2.."}[5m]))
            /
            sum(rate(http_server_requests_seconds_count[5m]))
          ) < 0.95
        for: 5m
        labels:
          severity: warning
          category: availability
        annotations:
          summary: "HTTPè¯·æ±‚æˆåŠŸç‡ä½"
          description: "æˆåŠŸç‡ï¼š{{ $value | humanizePercentage }}"
          action: "æ£€æŸ¥åº”ç”¨é”™è¯¯æ—¥å¿—"

      # æ•°æ®åº“è¿æ¥å¤±è´¥
      - alert: DatabaseConnectionError
        expr: hikaricp_connections_creation_failed > 0
        for: 2m
        labels:
          severity: critical
          category: database
        annotations:
          summary: "æ•°æ®åº“è¿æ¥åˆ›å»ºå¤±è´¥"
          description: "æ— æ³•åˆ›å»ºæ–°çš„æ•°æ®åº“è¿æ¥"
          action: "æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€å’Œç½‘ç»œè¿æ¥"





































