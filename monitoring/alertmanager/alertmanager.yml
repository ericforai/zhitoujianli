# Alertmanageré…ç½®
# æ™ºæŠ•ç®€å†å‘Šè­¦é€šçŸ¥é…ç½®

global:
  resolve_timeout: 5m
  # SMTPé…ç½®ï¼ˆç”¨äºé‚®ä»¶é€šçŸ¥ï¼‰
  smtp_smarthost: 'smtp.qq.com:465'
  smtp_from: '${ALERT_EMAIL_FROM:alert@zhitoujianli.com}'
  smtp_auth_username: '${ALERT_EMAIL_USER}'
  smtp_auth_password: '${ALERT_EMAIL_PASSWORD}'
  smtp_require_tls: true

# å‘Šè­¦è·¯ç”±
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  routes:
    # ä¸¥é‡å‘Šè­¦ - å¤šæ¸ é“é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 5m

    # è­¦å‘Š - é‚®ä»¶é€šçŸ¥
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 1h

# å‘Šè­¦æ¥æ”¶å™¨
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:8080/api/alerts/webhook'
        send_resolved: true

  # ä¸¥é‡å‘Šè­¦ - é‚®ä»¶ + Webhook
  - name: 'critical-alerts'
    email_configs:
      - to: '${ALERT_EMAIL_TO:admin@zhitoujianli.com}'
        headers:
          Subject: 'ğŸš¨ [ä¸¥é‡] {{ .GroupLabels.alertname }}'
        html: |
          <h2>ä¸¥é‡å‘Šè­¦</h2>
          <p><strong>å‘Šè­¦åç§°:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>æè¿°:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>å»ºè®®æ“ä½œ:</strong> {{ .CommonAnnotations.action }}</p>
          <p><strong>æ—¶é—´:</strong> {{ .StartsAt }}</p>
    webhook_configs:
      - url: 'http://localhost:8080/api/alerts/webhook'
        send_resolved: true

  # è­¦å‘Šå‘Šè­¦ - ä»…é‚®ä»¶
  - name: 'warning-alerts'
    email_configs:
      - to: '${ALERT_EMAIL_TO:admin@zhitoujianli.com}'
        headers:
          Subject: 'âš ï¸  [è­¦å‘Š] {{ .GroupLabels.alertname }}'

# æŠ‘åˆ¶è§„åˆ™ï¼ˆé¿å…å‘Šè­¦é£æš´ï¼‰
inhibit_rules:
  # æœåŠ¡å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶å…¶ä»–æ‰€æœ‰å‘Šè­¦
  - source_match:
      severity: 'critical'
      alertname: 'ServiceDown'
    target_match_re:
      severity: 'warning|info'
    equal: ['service']





































