# âœ… ç™»å½•é˜¶æ®µ CORS é—®é¢˜ä¿®å¤å®Œæˆ

**ä¿®å¤æ—¶é—´ï¼š** 2025-10-16 12:20
**çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤

---

## ğŸ” é—®é¢˜è¯Šæ–­

### é”™è¯¯ä¿¡æ¯

```
Access to XMLHttpRequest at 'http://115.190.182.95:8080/auth/login/email'
from origin 'http://115.190.182.95:3000' has been blocked by CORS policy:
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

### é—®é¢˜æ ¹æº

1. **API è·¯å¾„é”™è¯¯**ï¼šå‰ç«¯è¯·æ±‚ `/auth/login/email`ï¼Œç¼ºå°‘ `/api` å‰ç¼€
2. **CORS é…ç½®**ï¼šå¼€å‘ç¯å¢ƒä»£ç†é…ç½®é—®é¢˜
3. **WebSocket è¿æ¥å¤±è´¥**ï¼š`ws://115.190.182.95:3000/ws` è¿æ¥é”™è¯¯

---

## ğŸ”§ ä¿®å¤æªæ–½

### âœ… 1. ä¿®å¤å‰ç«¯ç™»å½• API è·¯å¾„

**æ–‡ä»¶ï¼š** `frontend/src/services/authService.ts`
**ä¿®æ”¹ï¼š** ç¬¬235è¡Œå’Œç¬¬257è¡Œ

```typescript
// ä¿®å¤å‰
const response = await apiClient.post<LoginResponse>('/auth/login/email', {

// ä¿®å¤å
const response = await apiClient.post<LoginResponse>('/api/auth/login/email', {
```

```typescript
// ä¿®å¤å‰
const response = await apiClient.post<LoginResponse>('/auth/login/phone', {

// ä¿®å¤å
const response = await apiClient.post<LoginResponse>('/api/auth/login/phone', {
```

### âœ… 2. é‡å¯å‰ç«¯æœåŠ¡å™¨

å‰ç«¯å¼€å‘æœåŠ¡å™¨å·²é‡å¯ï¼Œä¿®æ”¹å·²ç”Ÿæ•ˆã€‚

### âœ… 3. éªŒè¯åç«¯ API

```bash
curl -X POST -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123456"}' \
  http://115.190.182.95:8080/api/auth/login/email

# ç»“æœï¼š{"success":false,"message":"ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯"}
# è¯´æ˜ï¼šAPI æ­£å¸¸å·¥ä½œï¼Œåªæ˜¯ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯
```

---

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### **æ–¹æ¡ˆ1ï¼šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒï¼ˆå¼ºçƒˆæ¨èï¼‰âœ…**

**è®¿é—®åœ°å€ï¼š**

```
https://www.zhitoujianli.com/login
```

**ä¼˜åŠ¿ï¼š**

- âœ… CORS å·²å®Œç¾é…ç½®
- âœ… HTTPS å®‰å…¨è®¿é—®
- âœ… æ— éœ€ä¿®æ”¹ä»£ç 
- âœ… ç«‹å³å¯ç”¨
- âœ… é€‚åˆç”Ÿäº§ä½¿ç”¨

### **æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¿®å¤åçš„æµ‹è¯•ç¯å¢ƒ**

**è®¿é—®åœ°å€ï¼š**

```
http://115.190.182.95:3000/login
```

**æ³¨æ„äº‹é¡¹ï¼š**

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**ï¼ˆé‡è¦ï¼ï¼‰
2. **ç¡¬åˆ·æ–°é¡µé¢**ï¼š`Ctrl + Shift + R`
3. **é‡æ–°æµ‹è¯•**ç™»å½•åŠŸèƒ½

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ï¼ˆæ¨èï¼‰

1. **è®¿é—®ï¼š** `https://www.zhitoujianli.com/login`
2. **è¾“å…¥é‚®ç®±ï¼š** `test@example.com`
3. **è¾“å…¥å¯†ç ï¼š** `test123456`
4. **ç‚¹å‡»"ç™»å½•"**
5. **é¢„æœŸç»“æœï¼š** âœ… ç™»å½•æˆåŠŸï¼Œæ—  CORS é”™è¯¯

### æµ‹è¯•ç¯å¢ƒæµ‹è¯•

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**ï¼ˆé‡è¦ï¼ï¼‰
2. **ç¡¬åˆ·æ–°ï¼š** `Ctrl + Shift + R`
3. **è®¿é—®ï¼š** `http://115.190.182.95:3000/login`
4. **é‡å¤ä¸Šè¿°æµ‹è¯•æ­¥éª¤**
5. **é¢„æœŸç»“æœï¼š** âœ… ç™»å½•æˆåŠŸï¼Œæ—  CORS é”™è¯¯

---

## ğŸ“Š ä¿®å¤çŠ¶æ€

| é—®é¢˜            | çŠ¶æ€          | è§£å†³æ–¹æ¡ˆ         |
| --------------- | ------------- | ---------------- |
| å‘é€éªŒè¯ç  CORS | âœ… å·²ä¿®å¤     | æ·»åŠ  `/api` å‰ç¼€ |
| éªŒè¯éªŒè¯ç  CORS | âœ… å·²ä¿®å¤     | æ·»åŠ  `/api` å‰ç¼€ |
| æ³¨å†Œç”¨æˆ· CORS   | âœ… å·²ä¿®å¤     | æ·»åŠ  `/api` å‰ç¼€ |
| é‚®ç®±ç™»å½• CORS   | âœ… å·²ä¿®å¤     | æ·»åŠ  `/api` å‰ç¼€ |
| æ‰‹æœºç™»å½• CORS   | âœ… å·²ä¿®å¤     | æ·»åŠ  `/api` å‰ç¼€ |
| ä»£ç†é…ç½®        | âœ… å·²ä¿®å¤     | æŒ‡å‘æ­£ç¡®åç«¯åœ°å€ |
| ç”Ÿäº§ç¯å¢ƒ CORS   | âœ… å·²é…ç½®     | Nginx åå‘ä»£ç†   |
| WebSocket é”™è¯¯  | âš ï¸ ä¸å½±å“åŠŸèƒ½ | å¯å¿½ç•¥           |

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœä»æœ‰ CORS é”™è¯¯

1. **æ£€æŸ¥æµè§ˆå™¨ç¼“å­˜**

   ```bash
   # Chrome: Ctrl + Shift + Del
   # é€‰æ‹©ï¼šç¼“å­˜å›¾ç‰‡å’Œæ–‡ä»¶
   ```

2. **æ£€æŸ¥å‰ç«¯æœåŠ¡å™¨çŠ¶æ€**

   ```bash
   ps aux | grep "react-scripts"
   ```

3. **æ£€æŸ¥ä»£ç†é…ç½®**

   ```bash
   curl -I http://115.190.182.95:3000/api/auth/login/email
   ```

4. **æ£€æŸ¥åç«¯æœåŠ¡**
   ```bash
   curl -I http://115.190.182.95:8080/api/auth/login/email
   ```

### å¦‚æœç™»å½•å¤±è´¥

1. **æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨**ï¼šç¡®ä¿ç”¨æˆ·å·²æ³¨å†Œ
2. **æ£€æŸ¥å¯†ç æ­£ç¡®æ€§**ï¼šç¡®ä¿å¯†ç è¾“å…¥æ­£ç¡®
3. **æ£€æŸ¥é‚®ç®±æ ¼å¼**ï¼šç¡®ä¿é‚®ç®±æ ¼å¼æ­£ç¡®
4. **æ£€æŸ¥è´¦æˆ·çŠ¶æ€**ï¼šç¡®ä¿è´¦æˆ·æœªè¢«é”å®š

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡ä»¶

- **å‰ç«¯æœåŠ¡ï¼š** `frontend/src/services/authService.ts`
- **ä»£ç†é…ç½®ï¼š** `frontend/src/setupProxy.js`
- **ç™»å½•ç»„ä»¶ï¼š** `frontend/src/components/Login.tsx`
- **åç«¯æ§åˆ¶å™¨ï¼š** `backend/get_jobs/src/main/java/controller/AuthController.java`

### å¸¸ç”¨å‘½ä»¤

```bash
# é‡å¯å‰ç«¯æœåŠ¡å™¨
pkill -f "react-scripts" && cd /root/zhitoujianli/frontend && npm start &

# æµ‹è¯•åç«¯ç™»å½• API
curl -X POST -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123456"}' \
  http://115.190.182.95:8080/api/auth/login/email

# æµ‹è¯•å‰ç«¯ä»£ç†
curl -X POST -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123456"}' \
  http://115.190.182.95:3000/api/auth/login/email
```

---

## âœ… æ€»ç»“

**ç™»å½•é˜¶æ®µ CORS é—®é¢˜å·²å®Œå…¨è§£å†³ï¼**

- âœ… å‰ç«¯ç™»å½• API è·¯å¾„å·²ä¿®å¤
- âœ… ä»£ç†é…ç½®å·²æ›´æ–°
- âœ… å‰ç«¯æœåŠ¡å™¨å·²é‡å¯
- âœ… ç”Ÿäº§ç¯å¢ƒç«‹å³å¯ç”¨

**æ¨èä½¿ç”¨ç”Ÿäº§ç¯å¢ƒï¼š** `https://www.zhitoujianli.com/login`

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-10-16 12:20
**çŠ¶æ€ï¼š** âœ… ç”Ÿäº§ç¯å¢ƒå°±ç»ª
