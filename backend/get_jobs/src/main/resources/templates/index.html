<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™ºæŠ•ç®€å† - æ‰¾å·¥ä½œæ›´è½»æ¾</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      .config-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }
      .status-running {
        background-color: #28a745;
        animation: pulse 2s infinite;
      }
      .status-stopped {
        background-color: #dc3545;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
      .log-container {
        background: #1e1e1e;
        color: #ffffff;
        border-radius: 8px;
        padding: 15px;
        height: 400px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 12px;
      }
      .keyword-tag {
        background: #007bff;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        margin: 2px;
        display: inline-block;
      }
      .keyword-input {
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 10px;
        min-height: 50px;
      }
      .nav-tabs .nav-link {
        border-radius: 8px 8px 0 0;
      }
      .nav-tabs .nav-link.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- ä¾§è¾¹æ  -->
        <div class="col-md-3 bg-light p-3">
          <h4 class="mb-4"><i class="bi bi-robot"></i> AIæ‰¾å·¥ä½œåŠ©æ‰‹</h4>

          <!-- ç¨‹åºçŠ¶æ€ -->
          <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">æŠ•é€’çŠ¶æ€</h6>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusText">å·²åœæ­¢</span>
              </div>
              <div class="mb-2">
                <small class="text-muted">æŠ•é€’ç»Ÿè®¡: </small>
                <span id="deliveryCount" class="badge bg-primary">0</span>
              </div>
              <div class="d-grid gap-2">
                <button
                  class="btn btn-success btn-lg"
                  id="startBossTaskBtn"
                  onclick="startBossTask()"
                >
                  <i class="bi bi-play-fill"></i> å¯åŠ¨æŠ•é€’
                </button>
                <button class="btn btn-danger btn-sm" id="stopBtn" onclick="stopProgram()" disabled>
                  <i class="bi bi-stop-fill"></i> åœæ­¢æŠ•é€’
                </button>
              </div>
            </div>
          </div>

          <!-- å¹³å°é€‰æ‹© -->
          <div class="card mb-3">
            <div class="card-header">
              <h6 class="mb-0">é€‰æ‹©å¹³å°</h6>
            </div>
            <div class="card-body">
              <select class="form-select form-select-sm" id="platformSelect">
                <option value="boss.Boss">Bossç›´è˜</option>
                <option value="job51.Job51">å‰ç¨‹æ— å¿§</option>
                <option value="lagou.Lagou">æ‹‰å‹¾ç½‘</option>
                <option value="liepin.Liepin">çŒè˜ç½‘</option>
                <option value="zhilian.ZhiLian">æ™ºè”æ‹›è˜</option>
              </select>
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’® -->
          <div class="d-grid gap-2">
            <button class="btn btn-primary" onclick="saveConfig()">
              <i class="bi bi-save"></i> ä¿å­˜é…ç½®
            </button>
            <button class="btn btn-outline-secondary" onclick="loadConfig()">
              <i class="bi bi-arrow-clockwise"></i> é‡æ–°åŠ è½½
            </button>
          </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="col-md-9 p-3">
          <!-- é…ç½®æ ‡ç­¾é¡µ -->
          <ul class="nav nav-tabs" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="boss-tab"
                data-bs-toggle="tab"
                data-bs-target="#boss"
                type="button"
              >
                <i class="bi bi-briefcase"></i> Bossç›´è˜
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="resume-tab"
                data-bs-toggle="tab"
                data-bs-target="#resume"
                type="button"
              >
                <i class="bi bi-file-earmark-person"></i> ç®€å†ç®¡ç†
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="logs-tab"
                data-bs-toggle="tab"
                data-bs-target="#logs"
                type="button"
              >
                <i class="bi bi-journal-text"></i> è¿è¡Œæ—¥å¿—
              </button>
            </li>
          </ul>

          <div class="tab-content" id="configTabContent">
            <!-- Bossç›´è˜é…ç½® -->
            <div class="tab-pane fade show active" id="boss" role="tabpanel">
              <div class="config-section">
                <h5><i class="bi bi-gear"></i> Bossç›´è˜é…ç½®</h5>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">æœç´¢å…³é”®è¯</label>
                      <div
                        class="keyword-input"
                        id="bossKeywords"
                        contenteditable="true"
                        data-placeholder="è¾“å…¥å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”"
                      ></div>
                      <small class="text-muted">ä¾‹å¦‚ï¼šå¸‚åœºæ€»ç›‘,å¸‚åœºè¥é”€,å“ç‰Œè¥é”€</small>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">å·¥ä½œåŸå¸‚</label>
                      <select class="form-select" id="bossCityCode" multiple>
                        <option value="å…¨å›½">å…¨å›½</option>
                        <option value="åŒ—äº¬">åŒ—äº¬</option>
                        <option value="ä¸Šæµ·" selected>ä¸Šæµ·</option>
                        <option value="æ­å·">æ­å·</option>
                        <option value="å¹¿å·">å¹¿å·</option>
                        <option value="æ·±åœ³">æ·±åœ³</option>
                        <option value="æˆéƒ½">æˆéƒ½</option>
                        <option value="å¤©æ´¥">å¤©æ´¥</option>
                      </select>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">å·¥ä½œç»éªŒ</label>
                      <select class="form-select" id="bossExperience" multiple>
                        <option value="åº”å±Šæ¯•ä¸šç”Ÿ">åº”å±Šæ¯•ä¸šç”Ÿ</option>
                        <option value="1å¹´ä»¥ä¸‹">1å¹´ä»¥ä¸‹</option>
                        <option value="1-3å¹´">1-3å¹´</option>
                        <option value="3-5å¹´">3-5å¹´</option>
                        <option value="5-10å¹´">5-10å¹´</option>
                        <option value="10å¹´ä»¥ä¸Š" selected>10å¹´ä»¥ä¸Š</option>
                      </select>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">è–ªèµ„è¦æ±‚</label>
                      <select class="form-select" id="bossSalary">
                        <option value="3Kä»¥ä¸‹">3Kä»¥ä¸‹</option>
                        <option value="3-5K">3-5K</option>
                        <option value="5-10K">5-10K</option>
                        <option value="10-20K">10-20K</option>
                        <option value="20-50K">20-50K</option>
                        <option value="30Kä»¥ä¸Š" selected>30Kä»¥ä¸Š</option>
                        <option value="50Kä»¥ä¸Š">50Kä»¥ä¸Š</option>
                      </select>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">æœŸæœ›è–ªèµ„èŒƒå›´ (K)</label>
                      <div class="row">
                        <div class="col-6">
                          <input
                            type="number"
                            class="form-control"
                            id="expectedSalaryMin"
                            placeholder="æœ€ä½"
                            value="30"
                          />
                        </div>
                        <div class="col-6">
                          <input
                            type="number"
                            class="form-control"
                            id="expectedSalaryMax"
                            placeholder="æœ€é«˜"
                            value="50"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">æŠ•é€’é—´éš” (ç§’)</label>
                      <input
                        type="number"
                        class="form-control"
                        id="bossWaitTime"
                        value="10"
                        min="1"
                        max="60"
                      />
                    </div>

                    <div class="mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filterDeadHR" checked />
                        <label class="form-check-label" for="filterDeadHR"> è¿‡æ»¤ä¸æ´»è·ƒHR </label>
                      </div>
                    </div>

                    <div class="mb-3">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="enableSmartGreeting"
                          checked
                        />
                        <label class="form-check-label" for="enableSmartGreeting">
                          <strong>å¯ç”¨æ™ºèƒ½æ‰“æ‹›å‘¼è¯­ç”Ÿæˆï¼ˆåŸºäºç®€å†+JDï¼‰</strong>
                        </label>
                        <small class="form-text text-muted d-block mt-1">
                          <i class="bi bi-info-circle"></i> éœ€å…ˆåœ¨"ç®€å†ç®¡ç†"é¡µé¢ä¸Šä¼ ç®€å†
                        </small>
                      </div>
                    </div>

                    <div class="mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="sendImgResume" />
                        <label class="form-check-label" for="sendImgResume"> å‘é€å›¾ç‰‡ç®€å† </label>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <!-- ç®€å†ç®¡ç† -->
            <div class="tab-pane fade" id="resume" role="tabpanel">
              <div class="config-section">
                <h5><i class="bi bi-file-earmark-person"></i> ç®€å†ç®¡ç†</h5>

                <!-- ç®€å†ä¸Šä¼ åŒºåŸŸ -->
                <div class="card border-0 shadow-sm mb-4">
                  <div class="card-body p-4">
                    <h5 class="card-title mb-4"><i class="bi bi-cloud-upload"></i> ä¸Šä¼ ç®€å†</h5>

                    <!-- æ–‡ä»¶ä¸Šä¼  -->
                    <div
                      class="upload-area"
                      id="uploadArea"
                      style="
                        border: 3px dashed #dee2e6;
                        border-radius: 15px;
                        padding: 60px 40px;
                        text-align: center;
                        transition: all 0.3s ease;
                        cursor: pointer;
                        background: #f8f9fa;
                      "
                    >
                      <i class="bi bi-file-earmark-arrow-up fs-1 text-primary"></i>
                      <h4 class="mt-3">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h4>
                      <p class="text-muted">
                        <strong class="text-success">âœ… æ”¯æŒ TXTã€PDFã€DOCã€DOCX æ ¼å¼</strong><br />
                        <small>æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MB | AIè‡ªåŠ¨æå–æ–‡æœ¬å†…å®¹</small>
                      </p>
                      <input
                        type="file"
                        id="fileInput"
                        class="d-none"
                        accept=".txt,.pdf,.doc,.docx"
                      />
                    </div>

                    <!-- æ–‡æœ¬è¾“å…¥ -->
                    <div class="mt-4">
                      <label for="resumeText" class="form-label fw-bold">
                        <i class="bi bi-pencil-square"></i> æˆ–ç›´æ¥ç²˜è´´ç®€å†æ–‡æœ¬ï¼š
                      </label>
                      <textarea
                        class="form-control"
                        id="resumeText"
                        rows="12"
                        placeholder="è¯·ç²˜è´´æ‚¨çš„ç®€å†å†…å®¹...&#10;&#10;å»ºè®®åŒ…å«ï¼š&#10;- ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€èŒä½ï¼‰&#10;- å·¥ä½œç»å†ï¼ˆå…¬å¸ã€èŒä½ã€å¹´é™ï¼‰&#10;- æ ¸å¿ƒæŠ€èƒ½&#10;- ä¸»è¦æˆå°±&#10;- æ•™è‚²èƒŒæ™¯"
                      ></textarea>
                    </div>

                    <div class="mt-4 d-flex gap-3">
                      <button class="btn btn-primary btn-lg" id="parseBtn" onclick="parseResume()">
                        <i class="bi bi-cpu"></i> AIè§£æç®€å†
                      </button>
                      <button
                        class="btn btn-outline-danger"
                        id="deleteBtn"
                        onclick="deleteResume()"
                        style="display: none"
                      >
                        <i class="bi bi-trash"></i> åˆ é™¤ç®€å†
                      </button>
                    </div>
                  </div>
                </div>

                <!-- è§£æç»“æœå±•ç¤º -->
                <div id="parseResult" style="display: none">
                  <div
                    class="candidate-card"
                    style="
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border-radius: 15px;
                      padding: 30px;
                      margin-bottom: 30px;
                    "
                  >
                    <h4 class="mb-3">
                      <i class="bi bi-person-check-fill"></i>
                      è§£æç»“æœ
                    </h4>
                    <div id="candidateInfo">
                      <!-- å€™é€‰äººä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <!-- è¿è¡Œæ—¥å¿— -->
            <div class="tab-pane fade" id="logs" role="tabpanel">
              <div class="config-section">
                <h5><i class="bi bi-journal-text"></i> è¿è¡Œæ—¥å¿—</h5>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <div>
                    <button class="btn btn-outline-primary btn-sm" onclick="refreshLogs()">
                      <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°æ—¥å¿—
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="clearLogs()">
                      <i class="bi bi-trash"></i> æ¸…ç©ºæ˜¾ç¤º
                    </button>
                  </div>
                  <div>
                    <small class="text-muted">è‡ªåŠ¨åˆ·æ–°: </small>
                    <div class="form-check form-switch d-inline-block">
                      <input class="form-check-input" type="checkbox" id="autoRefresh" checked />
                    </div>
                  </div>
                </div>
                <div class="log-container" id="logContainer">
                  <div class="text-muted">ç­‰å¾…ç¨‹åºå¯åŠ¨...</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="messageToast" class="toast" role="alert">
        <div class="toast-header">
          <i class="bi bi-info-circle text-primary me-2"></i>
          <strong class="me-auto">ç³»ç»Ÿæ¶ˆæ¯</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage">æ¶ˆæ¯å†…å®¹</div>
      </div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div
      class="loading"
      id="loading"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9999;
      "
    >
      <div
        class="loading-content"
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          color: white;
        "
      >
        <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem">
          <span class="visually-hidden">å¤„ç†ä¸­...</span>
        </div>
        <h4 id="loadingText">AIæ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</h4>
        <p class="text-light">è¿™å¯èƒ½éœ€è¦10-30ç§’</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let autoRefreshInterval;
      let isRunning = false;

      // å®šæ—¶å™¨å¼•ç”¨ï¼Œç”¨äºæ¸…é™¤
      let statusTimer = null;
      let logsTimer = null;

      /**
       * éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
       */
      async function checkTokenValidity() {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (!token) {
          console.warn('âš ï¸ æœªæ‰¾åˆ°Token');
          return false;
        }

        try {
          // ç›´æ¥ä½¿ç”¨fetchéªŒè¯Tokenï¼Œé¿å…å¾ªç¯ä¾èµ–
          const response = await fetch('/api/config', {
            headers: {
              Authorization: `Bearer ${token}`,
              'X-Requested-With': 'XMLHttpRequest',
            },
            redirect: 'manual',
          });

          // æ£€æŸ¥å“åº”çŠ¶æ€
          if (
            response.type === 'opaqueredirect' ||
            response.status === 302 ||
            response.status === 401
          ) {
            console.warn('âš ï¸ Tokenå·²è¿‡æœŸ');
            return false;
          }

          return response.ok;
        } catch (error) {
          console.error('âŒ TokenéªŒè¯å¤±è´¥:', error);
          return false;
        }
      }

      /**
       * æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
       */
      function clearAllTimers() {
        if (statusTimer) {
          clearInterval(statusTimer);
          statusTimer = null;
        }
        if (logsTimer) {
          clearInterval(logsTimer);
          logsTimer = null;
        }
        console.log('âœ… å·²æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨');
      }

      // é€šç”¨è®¤è¯è¯·æ±‚å‡½æ•°
      function fetchWithAuth(url, options = {}) {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (!token) {
          console.log('ğŸ”“ æœªæ£€æµ‹åˆ°è®¤è¯tokenï¼Œä½¿ç”¨æ™®é€šè¯·æ±‚ï¼ˆå®‰å…¨è®¤è¯å¯èƒ½å·²ç¦ç”¨ï¼‰');
          // æ·»åŠ  X-Requested-With å¤´ï¼Œç¡®ä¿åç«¯è¯†åˆ«ä¸ºAJAXè¯·æ±‚
          options.headers = options.headers || {};
          options.headers['X-Requested-With'] = 'XMLHttpRequest';
          return fetch(url, options);
        } else {
          // å¦‚æœæœ‰tokenï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´
          options.headers = options.headers || {};
          options.headers['Authorization'] = `Bearer ${token}`;
          options.headers['X-Requested-With'] = 'XMLHttpRequest';
          return fetch(url, options);
        }

        // ğŸ”§ å…³é”®ä¿®å¤ï¼šé˜»æ­¢è‡ªåŠ¨è·Ÿéšé‡å®šå‘
        options.redirect = 'manual';

        return fetch(url, options).then(response => {
          // ç°åœ¨å¯ä»¥æ­£ç¡®æ£€æµ‹åˆ°302äº†
          if (response.type === 'opaqueredirect' || response.status === 0) {
            console.warn('âš ï¸ æ£€æµ‹åˆ°302é‡å®šå‘ï¼Œtokenå¯èƒ½å·²è¿‡æœŸ');
            localStorage.removeItem('authToken');
            clearAllTimers(); // æ¸…é™¤å®šæ—¶å™¨
            window.location.href = 'https://zhitoujianli.com/login';
            throw new Error('ç™»å½•å·²è¿‡æœŸ');
          }

          // å¤„ç†401æœªæˆæƒ
          if (response.status === 401) {
            console.warn('âš ï¸ 401æœªæˆæƒï¼Œtokenå·²è¿‡æœŸ');
            localStorage.removeItem('authToken');
            clearAllTimers(); // æ¸…é™¤å®šæ—¶å™¨
            window.location.href = 'https://zhitoujianli.com/login';
            throw new Error('ç™»å½•å·²è¿‡æœŸ');
          }

          // å¤„ç†éJSONå“åº”
          const contentType = response.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            console.error('éJSONå“åº”ï¼ŒContent-Type:', contentType);
            throw new Error('æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”');
          }

          return response;
        });
      }

      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      function checkLoginStatus() {
        const token = localStorage.getItem('authToken');
        if (!token) {
          window.location.href = 'https://zhitoujianli.com/login';
          return false;
        }
        return true;
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– - å·²åˆ é™¤ï¼Œä½¿ç”¨ä¸‹é¢çš„asyncç‰ˆæœ¬

      // åŠ è½½é…ç½®
      async function loadConfig() {
        try {
          const response = await fetchWithAuth('/api/config');
          const result = await response.json();

          if (result.success && result.config) {
            // å°†é…ç½®æ•°æ®å¡«å……åˆ°è¡¨å•ä¸­
            const config = result.config;

            // Bossç›´è˜é…ç½®
            if (config.boss) {
              // åŠ è½½å…³é”®è¯
              if (config.boss.keywords && Array.isArray(config.boss.keywords)) {
                const keywordsElement = document.getElementById('bossKeywords');
                if (keywordsElement) {
                  keywordsElement.textContent = config.boss.keywords.join(', ');
                }
              }


              // åŠ è½½åŸå¸‚
              if (config.boss.cityCode && Array.isArray(config.boss.cityCode)) {
                const citySelect = document.getElementById('bossCityCode');
                if (citySelect) {
                  citySelect.value = config.boss.cityCode[0]; // å–ç¬¬ä¸€ä¸ªåŸå¸‚
                }
              }

              // åŠ è½½å·¥ä½œç»éªŒ
              if (config.boss.experience && Array.isArray(config.boss.experience)) {
                const expSelect = document.getElementById('bossExperience');
                if (expSelect) {
                  expSelect.value = config.boss.experience[0]; // å–ç¬¬ä¸€ä¸ªç»éªŒè¦æ±‚
                }
              }

              // åŠ è½½è–ªèµ„
              if (config.boss.salary && Array.isArray(config.boss.salary)) {
                const salarySelect = document.getElementById('bossSalary');
                if (salarySelect) {
                  salarySelect.value = config.boss.salary[0]; // å–ç¬¬ä¸€ä¸ªè–ªèµ„èŒƒå›´
                }
              } else if (config.boss.salary) {
                const salarySelect = document.getElementById('bossSalary');
                if (salarySelect) {
                  salarySelect.value = config.boss.salary;
                }
              }

              // åŠ è½½æœŸæœ›è–ªèµ„
              if (config.boss.expectedSalary && Array.isArray(config.boss.expectedSalary)) {
                const minSalaryElement = document.getElementById('expectedSalaryMin');
                const maxSalaryElement = document.getElementById('expectedSalaryMax');
                if (minSalaryElement && config.boss.expectedSalary[0]) {
                  minSalaryElement.value = config.boss.expectedSalary[0];
                }
                if (maxSalaryElement && config.boss.expectedSalary[1]) {
                  maxSalaryElement.value = config.boss.expectedSalary[1];
                }
              }

              // åŠ è½½æŠ•é€’é—´éš”
              if (config.boss.waitTime) {
                const waitTimeElement = document.getElementById('bossWaitTime');
                if (waitTimeElement) {
                  waitTimeElement.value = config.boss.waitTime;
                }
              }

              // åŠ è½½å¼€å…³é€‰é¡¹
              if (config.boss.filterDeadHR !== undefined) {
                const filterDeadHRElement = document.getElementById('filterDeadHR');
                if (filterDeadHRElement) {
                  filterDeadHRElement.checked = config.boss.filterDeadHR;
                }
              }

              if (config.boss.enableAI !== undefined) {
                const enableAIElement = document.getElementById('enableAI');
                if (enableAIElement) {
                  enableAIElement.checked = config.boss.enableAI;
                }
              }

              if (config.boss.enableSmartGreeting !== undefined) {
                const enableSmartGreetingElement = document.getElementById('enableSmartGreeting');
                if (enableSmartGreetingElement) {
                  enableSmartGreetingElement.checked = config.boss.enableSmartGreeting;
                }
              }

              if (config.boss.sendImgResume !== undefined) {
                const sendImgResumeElement = document.getElementById('sendImgResume');
                if (sendImgResumeElement) {
                  sendImgResumeElement.checked = config.boss.sendImgResume;
                }
              }
            }

            console.log('é…ç½®åŠ è½½å®Œæˆ');
          } else {
            showMessage('åŠ è½½é…ç½®å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'), 'error');
          }
        } catch (error) {
          console.error('åŠ è½½é…ç½®é”™è¯¯:', error);
          showMessage('åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
        }
      }

      // ä¿å­˜é…ç½®
      async function saveConfig() {
        console.log('ğŸ”„ å¼€å§‹ä¿å­˜é…ç½®...');

        // æ£€æŸ¥æ‰€æœ‰å¿…éœ€çš„å…ƒç´ æ˜¯å¦å­˜åœ¨
        const requiredElements = [
          'bossKeywords', 'bossSalary', 'expectedSalaryMin',
          'expectedSalaryMax', 'bossWaitTime', 'filterDeadHR', 'enableSmartGreeting', 'sendImgResume'
        ];

        for (const elementId of requiredElements) {
          const element = document.getElementById(elementId);
          if (!element) {
            console.error(`âŒ å…ƒç´ ä¸å­˜åœ¨: ${elementId}`);
            showMessage(`é…ç½®é”™è¯¯ï¼šæ‰¾ä¸åˆ°å…ƒç´  ${elementId}`, 'error');
            return;
          }
          console.log(`âœ… å…ƒç´ å­˜åœ¨: ${elementId}`);
        }

        const config = {
          boss: {
            debugger: false,
            keywords: document
              .getElementById('bossKeywords')
              .textContent.split(',')
              .map(k => k.trim())
              .filter(k => k),
            industry: ['ä¸é™'], // æ·»åŠ è¡Œä¸šå­—æ®µ
            cityCode: Array.from(document.getElementById('bossCityCode').selectedOptions).map(
              o => o.value
            ),
            experience: Array.from(document.getElementById('bossExperience').selectedOptions).map(
              o => o.value
            ),
            jobType: 'ä¸é™',
            salary: [document.getElementById('bossSalary').value],
            degree: ['ä¸é™'],
            scale: ['ä¸é™'],
            stage: ['ä¸é™'],
            expectedSalary: [
              parseInt(document.getElementById('expectedSalaryMin').value),
              parseInt(document.getElementById('expectedSalaryMax').value),
            ],
            waitTime: document.getElementById('bossWaitTime').value,
            filterDeadHR: document.getElementById('filterDeadHR').checked,
            enableAI: document.getElementById('enableAI') ? document.getElementById('enableAI').checked : false,
            enableSmartGreeting: document.getElementById('enableSmartGreeting').checked,
            sendImgResume: document.getElementById('sendImgResume').checked,
            deadStatus: ['3æœˆå‰æ´»è·ƒ', 'åŠå¹´å‰æ´»è·ƒ', '1å¹´å‰æ´»è·ƒ', '2å¹´å‰æ´»è·ƒ'],
          },
          ai: {
            introduce: document.getElementById('aiIntroduce') ? document.getElementById('aiIntroduce').value : '',
            prompt: document.getElementById('aiPrompt') ? document.getElementById('aiPrompt').value : '',
          },
          bot: {
            is_send: document.getElementById('botIsSend') ? document.getElementById('botIsSend').checked : false,
          },
        };

        try {
          console.log('ğŸ”„ å¼€å§‹ä¿å­˜é…ç½®...');
          const response = await fetchWithAuth('/api/config', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(config),
          });

          console.log('ğŸ“¡ æ”¶åˆ°å“åº”:', response.status);
          const result = await response.json();
          console.log('ğŸ“‹ å“åº”æ•°æ®:', result);

          if (result.success) {
            console.log('âœ… å‡†å¤‡æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯');
            showMessage('é…ç½®ä¿å­˜æˆåŠŸ', 'success');
            console.log('âœ… showMessageå·²è°ƒç”¨');
          } else {
            console.log('âŒ å‡†å¤‡æ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯');
            showMessage('ä¿å­˜å¤±è´¥: ' + result.message, 'error');
          }
        } catch (error) {
          console.error('âŒ ä¿å­˜é…ç½®å¼‚å¸¸:', error);
          showMessage('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
        }
      }

      // å¯åŠ¨ç¨‹åº
      async function startProgram() {
        const platform = document.getElementById('platformSelect').value;

        try {
          const response = await fetchWithAuth('/start-program', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'platform=' + encodeURIComponent(platform),
          });

          const result = await response.json();
          if (result.success) {
            showMessage('ç¨‹åºå¯åŠ¨æˆåŠŸ', 'success');
            isRunning = true;
            updateStatus();
          } else {
            showMessage('å¯åŠ¨å¤±è´¥: ' + result.message, 'error');
          }
        } catch (error) {
          showMessage('å¯åŠ¨ç¨‹åºå¤±è´¥: ' + error.message, 'error');
        }
      }

      // å¯åŠ¨æŠ•é€’ä»»åŠ¡
      async function startBossTask() {
        try {
          const response = await fetchWithAuth('/start-boss-task', {
            method: 'POST',
          });

          const result = await response.json();
          if (result.success) {
            showMessage('æŠ•é€’ä»»åŠ¡å¯åŠ¨æˆåŠŸï¼å¼€å§‹è‡ªåŠ¨æŠ•é€’ç®€å†...', 'success');
            isRunning = true;
            updateStatus();
          } else {
            showMessage('å¯åŠ¨æŠ•é€’å¤±è´¥: ' + result.message, 'error');
          }
        } catch (error) {
          showMessage('å¯åŠ¨æŠ•é€’å¤±è´¥: ' + error.message, 'error');
        }
      }

      // åœæ­¢ç¨‹åº
      async function stopProgram() {
        try {
          const response = await fetchWithAuth('/stop-program', {
            method: 'POST',
          });

          const result = await response.json();
          if (result.success) {
            showMessage('æŠ•é€’å·²åœæ­¢', 'success');
            isRunning = false;
            updateStatus();
          } else {
            showMessage('åœæ­¢å¤±è´¥: ' + result.message, 'error');
          }
        } catch (error) {
          showMessage('åœæ­¢ç¨‹åºå¤±è´¥: ' + error.message, 'error');
        }
      }

      // æ›´æ–°çŠ¶æ€
      async function updateStatus() {
        try {
          const response = await fetchWithAuth('/status');
          const status = await response.json();

          isRunning = status.isRunning;
          const statusIndicator = document.getElementById('statusIndicator');
          const statusText = document.getElementById('statusText');
          const deliveryCount = document.getElementById('deliveryCount');
          const startBtn = document.getElementById('startBossTaskBtn');
          const stopBtn = document.getElementById('stopBtn');

          if (isRunning) {
            statusIndicator.className = 'status-indicator status-running';
            statusText.textContent = 'è¿è¡Œä¸­';
            startBtn.disabled = true;
            stopBtn.disabled = false;
          } else {
            statusIndicator.className = 'status-indicator status-stopped';
            statusText.textContent = 'å·²åœæ­¢';
            startBtn.disabled = false;
            stopBtn.disabled = true;
          }

          // æ›´æ–°æŠ•é€’ç»Ÿè®¡
          const count = status.deliveryCount || 0;
          deliveryCount.textContent = count;
          console.log('æŠ•é€’ç»Ÿè®¡æ›´æ–°:', count);
        } catch (error) {
          // å¦‚æœæ˜¯ç™»å½•è¿‡æœŸé”™è¯¯ï¼Œä¸æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆfetchWithAuthå·²å¤„ç†ï¼‰
          if (!error.message.includes('ç™»å½•å·²è¿‡æœŸ')) {
            console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
            showMessage('æ›´æ–°çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
          }
        }
      }

      // åˆ·æ–°æ—¥å¿—
      async function refreshLogs() {
        try {
          const response = await fetchWithAuth('/logs?lines=100');
          const result = await response.json();

          if (result.success && result.logs) {
            const logContainer = document.getElementById('logContainer');
            if (logContainer) {
              logContainer.innerHTML = result.logs
                .map(log => `<div class="log-line">${escapeHtml(log)}</div>`)
                .join('');
              logContainer.scrollTop = logContainer.scrollHeight;
            }
          } else {
            console.warn('æ—¥å¿—åŠ è½½å¤±è´¥:', result.message);
          }
        } catch (error) {
          // å¦‚æœæ˜¯ç™»å½•è¿‡æœŸé”™è¯¯ï¼Œä¸æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
          if (!error.message.includes('ç™»å½•å·²è¿‡æœŸ')) {
            console.error('åˆ·æ–°æ—¥å¿—å¤±è´¥:', error);
            showMessage('åˆ·æ–°æ—¥å¿—å¤±è´¥: ' + error.message, 'error');
          }
        }
      }

      // æ¸…ç©ºæ—¥å¿—æ˜¾ç¤º
      function clearLogs() {
        document.getElementById('logContainer').innerHTML =
          '<div class="text-muted">æ—¥å¿—å·²æ¸…ç©º</div>';
      }

      // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
      function startAutoRefresh() {
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }

        autoRefreshInterval = setInterval(() => {
          updateStatus();
          if (document.getElementById('autoRefresh').checked) {
            refreshLogs();
          }
        }, 3000);
      }

      // æ˜¾ç¤ºæ¶ˆæ¯
      function showMessage(message, type = 'info') {
        console.log('ğŸ“¢ showMessageè¢«è°ƒç”¨:', message, type);
        try {
          const toast = document.getElementById('messageToast');
          const toastMessage = document.getElementById('toastMessage');
          const toastHeader = toast.querySelector('.toast-header i');

          console.log('ğŸ“¢ Toastå…ƒç´ :', toast ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
          console.log('ğŸ“¢ ToastMessageå…ƒç´ :', toastMessage ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');

          toastMessage.textContent = message;

          // è®¾ç½®å›¾æ ‡å’Œé¢œè‰²
          toastHeader.className = 'bi me-2';
          if (type === 'success') {
            toastHeader.classList.add('bi-check-circle', 'text-success');
          } else if (type === 'error') {
            toastHeader.classList.add('bi-exclamation-triangle', 'text-danger');
          } else {
            toastHeader.classList.add('bi-info-circle', 'text-primary');
          }

          // ç¡®ä¿toastå®¹å™¨å¯è§
          const toastContainer = document.querySelector('.toast-container');
          toastContainer.style.display = 'block';

          console.log('ğŸ“¢ å‡†å¤‡åˆå§‹åŒ–Bootstrap Toast');
          const bsToast = new bootstrap.Toast(toast, {
            autohide: true,
            delay: 3000,
          });
          console.log('ğŸ“¢ è°ƒç”¨bsToast.show()');
          bsToast.show();
          console.log('ğŸ“¢ Toaståº”è¯¥å·²æ˜¾ç¤º');
        } catch (error) {
          console.error('âŒ showMessageæ‰§è¡Œå¤±è´¥:', error);
        }
      }

      // HTMLè½¬ä¹‰
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // å…³é”®è¯è¾“å…¥å¤„ç†
      document.getElementById('bossKeywords').addEventListener('input', function () {
        const text = this.textContent;
        const keywords = text
          .split(',')
          .map(k => k.trim())
          .filter(k => k);

        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…³é”®è¯æ ‡ç­¾æ˜¾ç¤º
        console.log('å…³é”®è¯:', keywords);
      });

      // æ£€æŸ¥ç™»å½•çŠ¶æ€ - å·²ç¦ç”¨è®¤è¯ï¼Œç›´æ¥è¿”å›true
      async function checkAuth() {
        console.log('è®¤è¯å·²ç¦ç”¨ï¼Œå…è®¸æ‰€æœ‰è®¿é—®');
        return true;
      }

      // é€€å‡ºç™»å½• - å·²ç¦ç”¨
      function logout() {
        console.log('ç™»å½•åŠŸèƒ½å·²ç¦ç”¨');
        // ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', async function () {
        console.log('ä¸»é¡µé¢å¼€å§‹åŠ è½½');

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const isLoggedIn = await checkTokenValidity();
        if (!isLoggedIn) {
          console.warn('âš ï¸ ç”¨æˆ·æœªç™»å½•æˆ–Tokenå·²è¿‡æœŸï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ');
          window.location.href = '/login';
          return;
        }

        console.log('âœ… è®¤è¯æ£€æŸ¥é€šè¿‡ï¼Œå¼€å§‹åˆå§‹åŒ–é¡µé¢');

        // åŠ è½½é…ç½®
        await loadConfig();

        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        startAutoRefresh();

        // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        updateStatus();
        refreshLogs();

        // ä¿å­˜å®šæ—¶å™¨å¼•ç”¨ï¼Œæ¯5ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€
        statusTimer = setInterval(updateStatus, 5000);

        // ä¿å­˜å®šæ—¶å™¨å¼•ç”¨ï¼Œæ¯2ç§’åˆ·æ–°ä¸€æ¬¡æ—¥å¿—
        logsTimer = setInterval(refreshLogs, 2000);

        // åˆå§‹åŒ–ç®€å†ç®¡ç†åŠŸèƒ½
        initializeResumeEventListeners();
        checkExistingResume();
      });

      // ç®€å†ç®¡ç†ç›¸å…³å‡½æ•° - å®Œå…¨ç§»æ¤è‡ªresume-manageré¡µé¢
      let candidateData = null;

      // åˆå§‹åŒ–ç®€å†ç®¡ç†äº‹ä»¶ç›‘å¬å™¨
      function initializeResumeEventListeners() {
        console.log('åˆå§‹åŒ–ç®€å†ç®¡ç†äº‹ä»¶ç›‘å¬å™¨...');

        // æ–‡ä»¶ä¸Šä¼ ç‚¹å‡»äº‹ä»¶
        const uploadArea = document.getElementById('uploadArea');
        if (uploadArea) {
          uploadArea.addEventListener('click', function () {
            console.log('ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ');
            document.getElementById('fileInput').click();
          });
        }

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
          fileInput.addEventListener('change', function (event) {
            console.log('æ–‡ä»¶é€‰æ‹©äº‹ä»¶è§¦å‘');
            handleFileUpload(event);
          });
        }

        // æ‹–æ‹½äº‹ä»¶
        if (uploadArea) {
          uploadArea.addEventListener('dragover', function (e) {
            e.preventDefault();
            console.log('æ‹–æ‹½ä¸­...');
            uploadArea.classList.add('dragover');
          });

          uploadArea.addEventListener('dragleave', function () {
            console.log('æ‹–æ‹½ç¦»å¼€');
            uploadArea.classList.remove('dragover');
          });

          uploadArea.addEventListener('drop', function (e) {
            e.preventDefault();
            console.log('æ–‡ä»¶æ‹–æ”¾');
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
              console.log('æ‹–æ”¾æ–‡ä»¶:', files[0].name);
              handleFileUpload({ target: { files: files } });
            }
          });
        }

        console.log('ç®€å†ç®¡ç†äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ');
      }

      // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç®€å†
      function checkExistingResume() {
        fetchWithAuth('/api/candidate-resume/check')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.hasResume) {
              // åŠ è½½å·²æœ‰ç®€å†
              loadExistingResume();
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      // åŠ è½½å·²æœ‰ç®€å†
      function loadExistingResume() {
        console.log('åŠ è½½å·²æœ‰ç®€å†...');
        fetchWithAuth('/api/candidate-resume/load')
          .then(response => response.json())
          .then(data => {
            console.log('ç®€å†åŠ è½½ç»“æœ:', data);
            if (data.success) {
              candidateData = data.data;
              displayCandidateInfo(candidateData);
              document.getElementById('deleteBtn').style.display = 'inline-block';

            }
          })
          .catch(error => {
            console.error('åŠ è½½ç®€å†é”™è¯¯:', error);
          });
      }

      // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) {
          console.log('æ²¡æœ‰é€‰æ‹©æ–‡ä»¶');
          return;
        }

        console.log('é€‰æ‹©çš„æ–‡ä»¶:', file.name, 'å¤§å°:', file.size, 'ç±»å‹:', file.type);

        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ10MBï¼‰
        if (file.size > 10 * 1024 * 1024) {
          alert('æ–‡ä»¶è¿‡å¤§ï¼Œè¯·ä¸Šä¼ å°äº10MBçš„æ–‡ä»¶');
          return;
        }

        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        const fileName = file.name.toLowerCase();
        if (
          !fileName.endsWith('.txt') &&
          !fileName.endsWith('.pdf') &&
          !fileName.endsWith('.doc') &&
          !fileName.endsWith('.docx')
        ) {
          alert('âŒ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼\n\næ”¯æŒçš„æ ¼å¼ï¼šTXTã€PDFã€DOCã€DOCX\nè¯·ä¸Šä¼ æ­£ç¡®æ ¼å¼çš„ç®€å†æ–‡ä»¶');
          return;
        }

        const formData = new FormData();
        formData.append('file', file);

        console.log('å¼€å§‹ä¸Šä¼ æ–‡ä»¶...');
        showLoading('æ­£åœ¨ä¸Šä¼ æ–‡ä»¶å¹¶è§£æç®€å†...');

        fetchWithAuth('/api/candidate-resume/upload', {
          method: 'POST',
          body: formData,
        })
          .then(response => {
            console.log('æ”¶åˆ°å“åº”ï¼ŒçŠ¶æ€:', response.status);
            return response.json();
          })
          .then(data => {
            console.log('è§£æå“åº”æ•°æ®:', data);
            hideLoading();
            if (data.success) {
              candidateData = data.data;
              displayCandidateInfo(candidateData);
              document.getElementById('deleteBtn').style.display = 'inline-block';


              alert('ç®€å†è§£ææˆåŠŸï¼');
            } else {
              alert('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + data.message);
            }
          })
          .catch(error => {
            hideLoading();
            console.error('ä¸Šä¼ é”™è¯¯:', error);
            alert('æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
          });

        // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡æ–°é€‰æ‹©ç›¸åŒæ–‡ä»¶
        event.target.value = '';
      }

      // è§£æç®€å†æ–‡æœ¬
      function parseResume() {
        const resumeText = document.getElementById('resumeText').value.trim();
        if (!resumeText) {
          alert('è¯·è¾“å…¥ç®€å†æ–‡æœ¬');
          return;
        }

        showLoading('AIæ­£åœ¨è§£æç®€å†...');

        fetchWithAuth('/api/candidate-resume/parse', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ resume_text: resumeText }),
        })
          .then(response => response.json())
          .then(data => {
            hideLoading();
            if (data.success) {
              candidateData = data.data;
              displayCandidateInfo(candidateData);
              document.getElementById('deleteBtn').style.display = 'inline-block';

            } else {
              alert('ç®€å†è§£æå¤±è´¥ï¼š' + data.message);
            }
          })
          .catch(error => {
            hideLoading();
            console.error('Error:', error);
            alert('ç®€å†è§£æå¤±è´¥ï¼š' + error.message);
          });
      }

      // åˆ é™¤ç®€å†
      function deleteResume() {
        if (!confirm('ç¡®å®šè¦åˆ é™¤å·²ä¿å­˜çš„ç®€å†å—ï¼Ÿ')) {
          return;
        }

        fetchWithAuth('/api/candidate-resume/delete', {
          method: 'POST',
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('ç®€å†å·²åˆ é™¤');
              candidateData = null;
              document.getElementById('parseResult').style.display = 'none';
              document.getElementById('deleteBtn').style.display = 'none';
              document.getElementById('resumeText').value = '';
            } else {
              alert('åˆ é™¤å¤±è´¥ï¼š' + data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
          });
      }

      // æ˜¾ç¤ºå€™é€‰äººä¿¡æ¯
      function displayCandidateInfo(candidate) {
        console.log('æ˜¾ç¤ºå€™é€‰äººä¿¡æ¯:', candidate);
        const candidateInfo = document.getElementById('candidateInfo');
        if (!candidateInfo) {
          console.error('æœªæ‰¾åˆ°candidateInfoå…ƒç´ ');
          return;
        }
        console.log('å¼€å§‹æ¸²æŸ“å€™é€‰äººä¿¡æ¯...');
        candidateInfo.innerHTML = `
           <div class="row">
             <div class="col-md-6">
               <h5><i class="bi bi-person-circle"></i> å€™é€‰äººä¿¡æ¯</h5>
               <p class="mb-2"><i class="bi bi-briefcase"></i> <strong>å½“å‰èŒä½ï¼š</strong>${candidate.current_title || 'æœªçŸ¥'}</p>
               <p class="mb-2"><i class="bi bi-calendar-check"></i> <strong>å·¥ä½œå¹´é™ï¼š</strong>${candidate.years_experience || 0}å¹´</p>
               <p class="mb-2"><i class="bi bi-mortarboard"></i> <strong>å­¦å†ï¼š</strong>${candidate.education || 'æœªçŸ¥'}</p>
               <p class="mb-2"><i class="bi bi-building"></i> <strong>å…¬å¸ï¼š</strong>${candidate.company || 'æœªçŸ¥'}</p>
             </div>
             <div class="col-md-6">
               <h6><i class="bi bi-stars"></i> æ ¸å¿ƒä¼˜åŠ¿ï¼š</h6>
               <div class="mb-3">
                 ${(candidate.core_strengths || [])
                   .map(
                     strength =>
                       `<span class="strength-tag" style="display: inline-block; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; margin: 5px; font-size: 0.9em; backdrop-filter: blur(10px);">${strength}</span>`
                   )
                   .join('')}
               </div>
               <h6><i class="bi bi-tools"></i> æŠ€èƒ½ï¼š</h6>
               <div>
                 ${(candidate.skills || [])
                   .map(
                     skill =>
                       `<span class="skill-badge" style="background: white; color: #667eea; padding: 6px 12px; border-radius: 15px; margin: 3px; font-size: 0.85em; display: inline-block;">${skill}</span>`
                   )
                   .join('')}
               </div>
             </div>
           </div>
         `;
        console.log('å€™é€‰äººä¿¡æ¯å·²æ¸²æŸ“');
        const parseResult = document.getElementById('parseResult');
        if (parseResult) {
          parseResult.style.display = 'block';
          console.log('è§£æç»“æœåŒºåŸŸå·²æ˜¾ç¤º');
        } else {
          console.error('æœªæ‰¾åˆ°parseResultå…ƒç´ ');
        }
      }





      // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
      function showLoading(text) {
        document.getElementById('loadingText').textContent = text || 'AIæ­£åœ¨å¤„ç†ä¸­...';
        document.getElementById('loading').style.display = 'block';
      }

      function hideLoading() {
        document.getElementById('loading').style.display = 'none';
      }
    </script>
  </body>
</html>

