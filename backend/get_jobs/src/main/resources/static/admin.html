<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智投简历 - 超级管理员控制台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .admin-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .admin-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .admin-form input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
        }
        
        .admin-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .dashboard-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .stat-value {
            color: #333;
            font-weight: bold;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .quick-links {
            margin-top: 30px;
            text-align: center;
        }
        
        .quick-links a {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
            border-radius: 25px;
            transition: all 0.3s;
        }
        
        .quick-links a:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 智投简历超级管理员控制台</h1>
            <p>商业化配额管理系统 - 管理员功能中心</p>
        </div>
        
        <div class="main-content">
            <!-- 创建超级管理员 -->
            <div class="admin-section">
                <h3>👑 创建超级管理员</h3>
                <div class="admin-form">
                    <input type="text" id="adminUserId" placeholder="输入用户ID（例如：super_admin_001）" value="super_admin_001">
                    <input type="text" id="adminRemarks" placeholder="备注说明（可选）" value="系统初始化超级管理员">
                    <button class="btn btn-primary" onclick="createSuperAdmin()">🎯 创建超级管理员</button>
                </div>
                <div id="createResult"></div>
            </div>
            
            <!-- 管理员功能 -->
            <div class="admin-section">
                <h3>⚙️ 管理员功能</h3>
                <div class="admin-form">
                    <button class="btn btn-success" onclick="loadDashboard()">📊 加载仪表板</button>
                    <button class="btn btn-info" onclick="loadUsers()">👥 用户管理</button>
                    <button class="btn btn-info" onclick="loadQuotas()">📋 配额管理</button>
                    <button class="btn btn-info" onclick="loadStats()">📈 统计分析</button>
                </div>
            </div>
            
            <!-- 仪表板数据 -->
            <div id="dashboardData"></div>
        </div>
        
        <div class="quick-links">
            <a href="/" target="_blank">🏠 返回首页</a>
            <a href="http://localhost:4321/blog/" target="_blank">📝 博客</a>
            <a href="/api/admin/dashboard" target="_blank">🔗 API数据</a>
        </div>
    </div>

    <script>
        // 创建超级管理员
        async function createSuperAdmin() {
            const userId = document.getElementById('adminUserId').value.trim();
            const remarks = document.getElementById('adminRemarks').value.trim();
            const resultDiv = document.getElementById('createResult');
            
            if (!userId) {
                showResult('createResult', 'error', '请输入用户ID');
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading"></div>正在创建超级管理员...';
            
            try {
                const response = await fetch('/api/admin/init-super-admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        remarks: remarks || '系统初始化超级管理员'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult('createResult', 'success', 
                        `✅ 超级管理员创建成功！<br>
                        用户ID: ${result.data.userId}<br>
                        管理员类型: ${result.data.adminType}<br>
                        登录地址: <a href="${result.data.loginUrl}" target="_blank">${result.data.loginUrl}</a><br>
                        管理面板: <a href="${result.data.adminDashboard}" target="_blank">${result.data.adminDashboard}</a>`
                    );
                } else {
                    showResult('createResult', 'error', '❌ ' + result.message);
                }
            } catch (error) {
                console.error('创建超级管理员失败:', error);
                showResult('createResult', 'error', '❌ 网络错误: ' + error.message);
            }
        }
        
        // 加载仪表板数据
        async function loadDashboard() {
            const dashboardDiv = document.getElementById('dashboardData');
            dashboardDiv.innerHTML = '<div class="loading"></div>正在加载仪表板数据...';
            
            try {
                const response = await fetch('/api/admin/dashboard');
                const result = await response.json();
                
                if (result.success) {
                    renderDashboard(result.data);
                } else {
                    dashboardDiv.innerHTML = `<div class="result error">❌ ${result.message}</div>`;
                }
            } catch (error) {
                console.error('加载仪表板失败:', error);
                dashboardDiv.innerHTML = `<div class="result error">❌ 网络错误: ${error.message}</div>`;
            }
        }
        
        // 渲染仪表板
        function renderDashboard(data) {
            const dashboardDiv = document.getElementById('dashboardData');
            dashboardDiv.innerHTML = `
                <div class="admin-section">
                    <h3>📊 系统仪表板</h3>
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h4>👥 用户统计</h4>
                            <div class="stat-item">
                                <span class="stat-label">总用户数</span>
                                <span class="stat-value">${data.totalUsers || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">活跃用户</span>
                                <span class="stat-value">${data.activeUsers || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">今日新用户</span>
                                <span class="stat-value">${data.newUsersToday || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">总收入</span>
                                <span class="stat-value">¥${data.totalRevenue || 0}</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <h4>📋 套餐分布</h4>
                            <div class="stat-item">
                                <span class="stat-label">🆓 免费版</span>
                                <span class="stat-value">${data.planDistribution?.FREE || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">📦 基础版</span>
                                <span class="stat-value">${data.planDistribution?.BASIC || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">💼 专业版</span>
                                <span class="stat-value">${data.planDistribution?.PROFESSIONAL || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">🏢 企业版</span>
                                <span class="stat-value">${data.planDistribution?.ENTERPRISE || 0}</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <h4>🎯 系统状态</h4>
                            <div class="stat-item">
                                <span class="stat-label">运行状态</span>
                                <span class="stat-value" style="color: ${data.systemStatus?.status === 'healthy' ? '#28a745' : '#dc3545'};">
                                    ${data.systemStatus?.status === 'healthy' ? '🟢 正常' : '🔴 异常'}
                                </span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">正常运行时间</span>
                                <span class="stat-value">${data.systemStatus?.uptime || 'N/A'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">响应时间</span>
                                <span class="stat-value">${data.systemStatus?.responseTime || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 加载用户列表
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const result = await response.json();
                
                if (result.success) {
                    alert(`用户管理功能\\n总用户数: ${result.data.total}\\n当前页用户: ${result.data.users.length}`);
                    console.log('用户列表:', result.data);
                } else {
                    alert('获取用户列表失败: ' + result.message);
                }
            } catch (error) {
                alert('网络错误: ' + error.message);
            }
        }
        
        // 加载配额数据
        function loadQuotas() {
            alert('配额管理功能:\\n- 查看用户配额使用情况\\n- 重置用户配额\\n- 配置配额限制\\n\\n功能已实现，可通过API调用');
        }
        
        // 加载统计数据
        async function loadStats() {
            try {
                const response = await fetch('/api/admin/statistics');
                const result = await response.json();
                
                if (result.success) {
                    alert('统计分析数据已获取，详细数据请查看控制台');
                    console.log('统计数据:', result.data);
                } else {
                    alert('获取统计数据失败: ' + result.message);
                }
            } catch (error) {
                alert('网络错误: ' + error.message);
            }
        }
        
        // 显示结果
        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        // 页面加载完成后自动尝试加载仪表板
        window.addEventListener('load', function() {
            setTimeout(loadDashboard, 1000);
        });
    </script>
</body>
</html>