<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™ºæŠ•ç®€å† - è¶…çº§ç®¡ç†å‘˜æ§åˆ¶å°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Microsoft YaHei', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .main-content {
        padding: 30px;
      }

      .admin-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 2px solid #f0f0f0;
        border-radius: 10px;
        background: #fafafa;
      }

      .admin-section h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3rem;
        border-bottom: 2px solid #667eea;
        padding-bottom: 5px;
      }

      .admin-form {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
      }

      .admin-form input {
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        min-width: 200px;
      }

      .admin-form input:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5a6fd8;
        transform: translateY(-2px);
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
      }

      .btn-info {
        background: #17a2b8;
        color: white;
      }

      .btn-info:hover {
        background: #138496;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .dashboard-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-left: 5px solid #667eea;
      }

      .dashboard-card h4 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .stat-item:last-child {
        border-bottom: none;
      }

      .stat-label {
        color: #666;
        font-weight: 500;
      }

      .stat-value {
        color: #333;
        font-weight: bold;
      }

      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 8px;
        font-weight: 500;
      }

      .result.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .result.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .result.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .quick-links {
        margin-top: 30px;
        text-align: center;
      }

      .quick-links a {
        display: inline-block;
        margin: 0 10px;
        padding: 10px 20px;
        color: #667eea;
        text-decoration: none;
        border: 2px solid #667eea;
        border-radius: 25px;
        transition: all 0.3s;
      }

      .quick-links a:hover {
        background: #667eea;
        color: white;
      }

      /* å¥åº·ç›‘æ§æ ·å¼ */
      .health-status-indicator {
        display: inline-block;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      .health-status-indicator.green {
        background: #28a745;
        box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
      }

      .health-status-indicator.yellow {
        background: #ffc107;
        box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
      }

      .health-status-indicator.red {
        background: #dc3545;
        box-shadow: 0 0 15px rgba(220, 53, 69, 0.6);
      }

      .health-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .health-card h4 {
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 8px;
      }

      .metric-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .metric-label {
        color: #666;
        font-weight: 500;
      }

      .metric-value {
        color: #333;
        font-weight: bold;
      }

      .log-entry {
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        font-size: 0.9rem;
        font-family: 'Courier New', monospace;
      }

      .log-entry.success {
        background: #d4edda;
        border-left: 4px solid #28a745;
      }

      .log-entry.warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
      }

      .log-entry.error {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
      }

      .log-entry.info {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;
      }

      .log-timestamp {
        color: #666;
        font-size: 0.85rem;
        margin-right: 10px;
      }

      .alert-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: bold;
        margin-left: 10px;
      }

      .alert-badge.critical {
        background: #dc3545;
        color: white;
      }

      .alert-badge.high {
        background: #ff6b6b;
        color: white;
      }

      .alert-badge.medium {
        background: #ffc107;
        color: #333;
      }

      .refresh-indicator {
        display: inline-block;
        color: #28a745;
        font-size: 0.9rem;
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸš€ æ™ºæŠ•ç®€å†è¶…çº§ç®¡ç†å‘˜æ§åˆ¶å°</h1>
        <p>å•†ä¸šåŒ–é…é¢ç®¡ç†ç³»ç»Ÿ - ç®¡ç†å‘˜åŠŸèƒ½ä¸­å¿ƒ</p>
      </div>

      <div class="main-content">
        <!-- åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ -->
        <div class="admin-section">
          <h3>ğŸ‘‘ åˆ›å»ºè¶…çº§ç®¡ç†å‘˜</h3>
          <div class="admin-form">
            <input
              type="text"
              id="adminUserId"
              placeholder="è¾“å…¥ç”¨æˆ·IDï¼ˆä¾‹å¦‚ï¼šsuper_admin_001ï¼‰"
              value="super_admin_001"
            />
            <input
              type="text"
              id="adminRemarks"
              placeholder="å¤‡æ³¨è¯´æ˜ï¼ˆå¯é€‰ï¼‰"
              value="ç³»ç»Ÿåˆå§‹åŒ–è¶…çº§ç®¡ç†å‘˜"
            />
            <button class="btn btn-primary" onclick="createSuperAdmin()">ğŸ¯ åˆ›å»ºè¶…çº§ç®¡ç†å‘˜</button>
          </div>
          <div id="createResult"></div>
        </div>

        <!-- ç®¡ç†å‘˜åŠŸèƒ½ -->
        <div class="admin-section">
          <h3>âš™ï¸ ç®¡ç†å‘˜åŠŸèƒ½</h3>
          <div class="admin-form">
            <button class="btn btn-success" onclick="loadDashboard()">ğŸ“Š åŠ è½½ä»ªè¡¨æ¿</button>
            <button
              class="btn btn-success"
              onclick="loadHealthMonitor()"
              style="background: #28a745"
            >
              ğŸ¥ å¥åº·ç›‘æ§
            </button>
            <button class="btn btn-info" onclick="loadUsers()">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</button>
            <button class="btn btn-info" onclick="loadQuotas()">ğŸ“‹ é…é¢ç®¡ç†</button>
            <button class="btn btn-info" onclick="loadStats()">ğŸ“ˆ ç»Ÿè®¡åˆ†æ</button>
          </div>
        </div>

        <!-- ä»ªè¡¨æ¿æ•°æ® -->
        <div id="dashboardData"></div>
      </div>

      <div class="quick-links">
        <a href="/" target="_blank">ğŸ  è¿”å›é¦–é¡µ</a>
        <a href="http://localhost:4321/blog/" target="_blank">ğŸ“ åšå®¢</a>
        <a href="/api/admin/dashboard" target="_blank">ğŸ”— APIæ•°æ®</a>
      </div>
    </div>

    <script>
      // åˆ›å»ºè¶…çº§ç®¡ç†å‘˜
      async function createSuperAdmin() {
        const userId = document.getElementById('adminUserId').value.trim();
        const remarks = document.getElementById('adminRemarks').value.trim();
        const resultDiv = document.getElementById('createResult');

        if (!userId) {
          showResult('createResult', 'error', 'è¯·è¾“å…¥ç”¨æˆ·ID');
          return;
        }

        resultDiv.innerHTML = '<div class="loading"></div>æ­£åœ¨åˆ›å»ºè¶…çº§ç®¡ç†å‘˜...';

        try {
          const response = await fetch('/api/admin/init-super-admin', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              userId: userId,
              remarks: remarks || 'ç³»ç»Ÿåˆå§‹åŒ–è¶…çº§ç®¡ç†å‘˜',
            }),
          });

          const result = await response.json();

          if (result.success) {
            showResult(
              'createResult',
              'success',
              `âœ… è¶…çº§ç®¡ç†å‘˜åˆ›å»ºæˆåŠŸï¼<br>
                        ç”¨æˆ·ID: ${result.data.userId}<br>
                        ç®¡ç†å‘˜ç±»å‹: ${result.data.adminType}<br>
                        ç™»å½•åœ°å€: <a href="${result.data.loginUrl}" target="_blank">${result.data.loginUrl}</a><br>
                        ç®¡ç†é¢æ¿: <a href="${result.data.adminDashboard}" target="_blank">${result.data.adminDashboard}</a>`
            );
          } else {
            showResult('createResult', 'error', 'âŒ ' + result.message);
          }
        } catch (error) {
          console.error('åˆ›å»ºè¶…çº§ç®¡ç†å‘˜å¤±è´¥:', error);
          showResult('createResult', 'error', 'âŒ ç½‘ç»œé”™è¯¯: ' + error.message);
        }
      }

      // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
      async function loadDashboard() {
        const dashboardDiv = document.getElementById('dashboardData');
        dashboardDiv.innerHTML = '<div class="loading"></div>æ­£åœ¨åŠ è½½ä»ªè¡¨æ¿æ•°æ®...';

        try {
          const response = await fetch('/api/admin/dashboard');
          const result = await response.json();

          if (result.success) {
            renderDashboard(result.data);
          } else {
            dashboardDiv.innerHTML = `<div class="result error">âŒ ${result.message}</div>`;
          }
        } catch (error) {
          console.error('åŠ è½½ä»ªè¡¨æ¿å¤±è´¥:', error);
          dashboardDiv.innerHTML = `<div class="result error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
        }
      }

      // æ¸²æŸ“ä»ªè¡¨æ¿
      function renderDashboard(data) {
        const dashboardDiv = document.getElementById('dashboardData');
        dashboardDiv.innerHTML = `
                <div class="admin-section">
                    <h3>ğŸ“Š ç³»ç»Ÿä»ªè¡¨æ¿</h3>
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h4>ğŸ‘¥ ç”¨æˆ·ç»Ÿè®¡</h4>
                            <div class="stat-item">
                                <span class="stat-label">æ€»ç”¨æˆ·æ•°</span>
                                <span class="stat-value">${data.totalUsers || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æ´»è·ƒç”¨æˆ·</span>
                                <span class="stat-value">${data.activeUsers || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ä»Šæ—¥æ–°ç”¨æˆ·</span>
                                <span class="stat-value">${data.newUsersToday || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æ€»æ”¶å…¥</span>
                                <span class="stat-value">Â¥${data.totalRevenue || 0}</span>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h4>ğŸ“‹ å¥—é¤åˆ†å¸ƒ</h4>
                            <div class="stat-item">
                                <span class="stat-label">ğŸ†“ å…è´¹ç‰ˆ</span>
                                <span class="stat-value">${data.planDistribution?.FREE || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ğŸ“¦ åŸºç¡€ç‰ˆ</span>
                                <span class="stat-value">${data.planDistribution?.BASIC || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ğŸ’¼ ä¸“ä¸šç‰ˆ</span>
                                <span class="stat-value">${data.planDistribution?.PROFESSIONAL || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ğŸ¢ ä¼ä¸šç‰ˆ</span>
                                <span class="stat-value">${data.planDistribution?.ENTERPRISE || 0}</span>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h4>ğŸ¯ ç³»ç»ŸçŠ¶æ€</h4>
                            <div class="stat-item">
                                <span class="stat-label">è¿è¡ŒçŠ¶æ€</span>
                                <span class="stat-value" style="color: ${data.systemStatus?.status === 'healthy' ? '#28a745' : '#dc3545'};">
                                    ${data.systemStatus?.status === 'healthy' ? 'ğŸŸ¢ æ­£å¸¸' : 'ğŸ”´ å¼‚å¸¸'}
                                </span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æ­£å¸¸è¿è¡Œæ—¶é—´</span>
                                <span class="stat-value">${data.systemStatus?.uptime || 'N/A'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å“åº”æ—¶é—´</span>
                                <span class="stat-value">${data.systemStatus?.responseTime || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      // åŠ è½½ç”¨æˆ·åˆ—è¡¨
      async function loadUsers() {
        try {
          const response = await fetch('/api/admin/users');
          const result = await response.json();

          if (result.success) {
            alert(
              `ç”¨æˆ·ç®¡ç†åŠŸèƒ½\\næ€»ç”¨æˆ·æ•°: ${result.data.total}\\nå½“å‰é¡µç”¨æˆ·: ${result.data.users.length}`
            );
            console.log('ç”¨æˆ·åˆ—è¡¨:', result.data);
          } else {
            alert('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: ' + result.message);
          }
        } catch (error) {
          alert('ç½‘ç»œé”™è¯¯: ' + error.message);
        }
      }

      // åŠ è½½é…é¢æ•°æ®
      function loadQuotas() {
        alert(
          'é…é¢ç®¡ç†åŠŸèƒ½:\\n- æŸ¥çœ‹ç”¨æˆ·é…é¢ä½¿ç”¨æƒ…å†µ\\n- é‡ç½®ç”¨æˆ·é…é¢\\n- é…ç½®é…é¢é™åˆ¶\\n\\nåŠŸèƒ½å·²å®ç°ï¼Œå¯é€šè¿‡APIè°ƒç”¨'
        );
      }

      // åŠ è½½ç»Ÿè®¡æ•°æ®
      async function loadStats() {
        try {
          const response = await fetch('/api/admin/statistics');
          const result = await response.json();

          if (result.success) {
            alert('ç»Ÿè®¡åˆ†ææ•°æ®å·²è·å–ï¼Œè¯¦ç»†æ•°æ®è¯·æŸ¥çœ‹æ§åˆ¶å°');
            console.log('ç»Ÿè®¡æ•°æ®:', result.data);
          } else {
            alert('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + result.message);
          }
        } catch (error) {
          alert('ç½‘ç»œé”™è¯¯: ' + error.message);
        }
      }

      // ========== å¥åº·ç›‘æ§åŠŸèƒ½ ==========

      let healthRefreshInterval = null;

      // åŠ è½½å¥åº·ç›‘æ§é¢æ¿
      async function loadHealthMonitor() {
        const dashboardDiv = document.getElementById('dashboardData');
        dashboardDiv.innerHTML = '<div class="loading"></div>æ­£åœ¨åŠ è½½å¥åº·ç›‘æ§æ•°æ®...';

        try {
          const response = await fetch('/api/admin/health/dashboard');
          const result = await response.json();

          if (result.success) {
            renderHealthDashboard(result.data);
            startAutoRefresh();
          } else {
            dashboardDiv.innerHTML = `<div class="result error">âŒ ${result.message}</div>`;
          }
        } catch (error) {
          console.error('åŠ è½½å¥åº·ç›‘æ§å¤±è´¥:', error);
          dashboardDiv.innerHTML = `<div class="result error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
        }
      }

      // æ¸²æŸ“å¥åº·ç›‘æ§é¢æ¿
      function renderHealthDashboard(data) {
        const dashboardDiv = document.getElementById('dashboardData');
        const status = data.status || {};
        const metrics = data.metrics || {};
        const logs = data.logs || [];
        const alerts = data.alerts || [];

        const html = `
                <div class="admin-section">
                    <h3>ğŸ¥ ç³»ç»Ÿå¥åº·ç›‘æ§ <span class="refresh-indicator" id="refreshIndicator">âŸ³ è‡ªåŠ¨åˆ·æ–°ä¸­...</span></h3>

                    <!-- æ•´ä½“çŠ¶æ€å¡ç‰‡ -->
                    <div class="health-card">
                        <h4>ğŸ“Š å®æ—¶çŠ¶æ€</h4>
                        <div class="metric-row">
                            <span class="metric-label">ç³»ç»ŸçŠ¶æ€</span>
                            <span class="metric-value">
                                <span class="health-status-indicator ${status.statusColor || 'gray'}"></span>
                                ${status.status || 'æœªçŸ¥'}
                            </span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">è¿è¡Œæ—¶é•¿</span>
                            <span class="metric-value">${status.uptimeFormatted || 'N/A'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">ç«¯å£8080çŠ¶æ€</span>
                            <span class="metric-value" style="color: ${status.portListening ? '#28a745' : '#dc3545'};">
                                ${status.portListening ? 'âœ… æ­£å¸¸ç›‘å¬' : 'âŒ æœªç›‘å¬'}
                            </span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">æœ€è¿‘24å°æ—¶å‘Šè­¦</span>
                            <span class="metric-value" style="color: ${status.recentAlerts > 0 ? '#dc3545' : '#28a745'};">
                                ${status.recentAlerts || 0} æ¬¡
                            </span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">æœ€åæ£€æŸ¥ç»“æœ</span>
                            <span class="metric-value">${status.lastCheckResult || 'N/A'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">æ›´æ–°æ—¶é—´</span>
                            <span class="metric-value">${status.timestamp || 'N/A'}</span>
                        </div>
                    </div>

                    <!-- ç³»ç»ŸæŒ‡æ ‡å¡ç‰‡ -->
                    <div class="health-card">
                        <h4>ğŸ’» ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡</h4>
                        <div class="metric-row">
                            <span class="metric-label">å†…å­˜ä½¿ç”¨</span>
                            <span class="metric-value">
                                ${metrics.memoryUsed || 0} MB / ${metrics.memoryTotal || 0} MB
                                (${(metrics.memoryUsagePercent || 0).toFixed(1)}%)
                            </span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">CPUä½¿ç”¨ç‡</span>
                            <span class="metric-value">${(metrics.cpuUsagePercent || 0).toFixed(1)}%</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">å¯ç”¨å¤„ç†å™¨</span>
                            <span class="metric-value">${metrics.availableProcessors || 'N/A'} æ ¸</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">JVMè¿è¡Œæ—¶é—´</span>
                            <span class="metric-value">${formatSeconds(metrics.jvmUptime || 0)}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">æœåŠ¡PID</span>
                            <span class="metric-value">${metrics.servicePid || 'unknown'}</span>
                        </div>
                    </div>

                    <!-- å‘Šè­¦å†å² -->
                    ${
                      alerts.length > 0
                        ? `
                    <div class="health-card">
                        <h4>ğŸš¨ æœ€è¿‘å‘Šè­¦ (${alerts.length}æ¡)</h4>
                        ${alerts
                          .map(
                            alert => `
                            <div class="log-entry error">
                                <span class="log-timestamp">${alert.timestamp}</span>
                                <span>${alert.message}</span>
                                <span class="alert-badge ${alert.severity}">${alert.severity.toUpperCase()}</span>
                            </div>
                        `
                          )
                          .join('')}
                    </div>
                    `
                        : ''
                    }

                    <!-- å¥åº·æ£€æŸ¥æ—¥å¿— -->
                    <div class="health-card">
                        <h4>ğŸ“‹ å¥åº·æ£€æŸ¥æ—¥å¿— (æœ€è¿‘${logs.length}æ¡)</h4>
                        ${
                          logs.length > 0
                            ? logs
                                .map(
                                  log => `
                            <div class="log-entry ${log.level}">
                                <span class="log-timestamp">${log.timestamp}</span>
                                <span>${log.message}</span>
                            </div>
                        `
                                )
                                .join('')
                            : '<p>æš‚æ— æ—¥å¿—æ•°æ®</p>'
                        }
                    </div>
                </div>
            `;

        dashboardDiv.innerHTML = html;
      }

      // æ ¼å¼åŒ–ç§’æ•°
      function formatSeconds(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        if (hours > 0) {
          return `${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
        } else if (minutes > 0) {
          return `${minutes}åˆ†é’Ÿ ${secs}ç§’`;
        } else {
          return `${secs}ç§’`;
        }
      }

      // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
      function startAutoRefresh() {
        // åœæ­¢ä¹‹å‰çš„å®šæ—¶å™¨
        if (healthRefreshInterval) {
          clearInterval(healthRefreshInterval);
        }

        // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
        healthRefreshInterval = setInterval(async () => {
          try {
            const response = await fetch('/api/admin/health/dashboard');
            const result = await response.json();

            if (result.success) {
              renderHealthDashboard(result.data);
              updateRefreshIndicator();
            }
          } catch (error) {
            console.error('è‡ªåŠ¨åˆ·æ–°å¤±è´¥:', error);
          }
        }, 30000); // 30ç§’

        console.log('âœ… å¥åº·ç›‘æ§è‡ªåŠ¨åˆ·æ–°å·²å¯åŠ¨ï¼ˆæ¯30ç§’ï¼‰');
      }

      // æ›´æ–°åˆ·æ–°æŒ‡ç¤ºå™¨
      function updateRefreshIndicator() {
        const indicator = document.getElementById('refreshIndicator');
        if (indicator) {
          indicator.style.color = '#28a745';
          setTimeout(() => {
            indicator.style.color = '';
          }, 500);
        }
      }

      // åœæ­¢è‡ªåŠ¨åˆ·æ–°
      function stopAutoRefresh() {
        if (healthRefreshInterval) {
          clearInterval(healthRefreshInterval);
          healthRefreshInterval = null;
          console.log('â¸ï¸ å¥åº·ç›‘æ§è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢');
        }
      }

      // æ˜¾ç¤ºç»“æœ
      function showResult(elementId, type, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="result ${type}">${message}</div>`;
      }

      // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å°è¯•åŠ è½½ä»ªè¡¨æ¿
      window.addEventListener('load', function () {
        setTimeout(loadDashboard, 1000);
      });
    </script>
  </body>
</html>
