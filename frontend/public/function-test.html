<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™ºæŠ•ç®€å† - åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .tab-button.active {
        border-bottom-color: #4f46e5;
        color: #4f46e5;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-indigo-600">æ™ºæŠ•ç®€å†</h1>
            <span class="ml-4 text-sm text-gray-500">åŠŸèƒ½æµ‹è¯•é¡µé¢</span>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-700">æ¬¢è¿ï¼Œè®¿å®¢ç”¨æˆ·</span>
          </div>
        </div>
      </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- é¡µé¢æ ‡é¢˜ -->
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900">æ™ºèƒ½ç®€å†ç®¡ç†åŠŸèƒ½æµ‹è¯•</h2>
        <p class="mt-2 text-gray-600">æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
      </div>

      <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
      <div class="border-b border-gray-200 mb-8">
        <nav class="-mb-px flex space-x-8">
          <button
            id="resume-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-600"
            onclick="switchTab('resume')"
          >
            <span>ğŸ“„</span>
            <span>ç®€å†ç®¡ç†</span>
          </button>
          <button
            id="config-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
            onclick="switchTab('config')"
          >
            <span>âš™ï¸</span>
            <span>æŠ•é€’é…ç½®</span>
          </button>
          <button
            id="delivery-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
            onclick="switchTab('delivery')"
          >
            <span>ğŸš€</span>
            <span>è‡ªåŠ¨æŠ•é€’</span>
          </button>
        </nav>
      </div>

      <!-- æ ‡ç­¾é¡µå†…å®¹ -->
      <div>
        <!-- ç®€å†ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="resume-content" class="tab-content active">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">ç®€å†ç®¡ç†åŠŸèƒ½æµ‹è¯•</h3>
            <p class="text-gray-600 mb-6">æµ‹è¯•ç®€å†ä¸Šä¼ ã€è§£æå’Œç®¡ç†åŠŸèƒ½</p>

            <!-- ç®€å†çŠ¶æ€æ£€æŸ¥ -->
            <div id="resume-status" class="mb-6">
              <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div
                    class="animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-2"
                  ></div>
                  <span class="text-yellow-800">æ­£åœ¨æ£€æŸ¥ç®€å†çŠ¶æ€...</span>
                </div>
              </div>
            </div>

            <!-- åŠŸèƒ½æµ‹è¯•æŒ‰é’® -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">APIæµ‹è¯•</h4>
                <button
                  onclick="testResumeCheck()"
                  class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  æµ‹è¯•ç®€å†æ£€æŸ¥API
                </button>
                <button
                  onclick="testResumeInfo()"
                  class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                >
                  æµ‹è¯•ç®€å†ä¿¡æ¯API
                </button>
                <button
                  onclick="testResumeUpload()"
                  class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                  æµ‹è¯•ç®€å†ä¸Šä¼ API
                </button>
              </div>

              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">åŠŸèƒ½æµ‹è¯•</h4>
                <button
                  onclick="testFileValidation()"
                  class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
                >
                  æµ‹è¯•æ–‡ä»¶éªŒè¯
                </button>
                <button
                  onclick="testResumeParse()"
                  class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                >
                  æµ‹è¯•ç®€å†è§£æ
                </button>
                <button
                  onclick="testResumeDelete()"
                  class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                  æµ‹è¯•ç®€å†åˆ é™¤
                </button>
              </div>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div id="test-results" class="mt-6">
              <h4 class="text-lg font-medium text-gray-900 mb-4">æµ‹è¯•ç»“æœ</h4>
              <div
                id="test-output"
                class="bg-gray-100 rounded-lg p-4 min-h-[200px]"
              >
                <p class="text-gray-500">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- æŠ•é€’é…ç½®æ ‡ç­¾é¡µ -->
        <div id="config-content" class="tab-content">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">æŠ•é€’é…ç½®åŠŸèƒ½æµ‹è¯•</h3>
            <p class="text-gray-600 mb-6">æµ‹è¯•æŠ•é€’é…ç½®ç›¸å…³çš„APIåŠŸèƒ½</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">é…ç½®APIæµ‹è¯•</h4>
                <button
                  onclick="testDeliveryConfig()"
                  class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  æµ‹è¯•æŠ•é€’é…ç½®API
                </button>
                <button
                  onclick="testBossConfig()"
                  class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                >
                  æµ‹è¯•Bossé…ç½®API
                </button>
                <button
                  onclick="testBlacklistConfig()"
                  class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                  æµ‹è¯•é»‘åå•é…ç½®API
                </button>
              </div>

              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">é…ç½®æ›´æ–°æµ‹è¯•</h4>
                <button
                  onclick="testConfigUpdate()"
                  class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
                >
                  æµ‹è¯•é…ç½®æ›´æ–°
                </button>
                <button
                  onclick="testConfigValidation()"
                  class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                >
                  æµ‹è¯•é…ç½®éªŒè¯
                </button>
                <button
                  onclick="testConfigTest()"
                  class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                  æµ‹è¯•é…ç½®æµ‹è¯•
                </button>
              </div>
            </div>

            <!-- é…ç½®æµ‹è¯•ç»“æœ -->
            <div id="config-test-results" class="mt-6">
              <h4 class="text-lg font-medium text-gray-900 mb-4">
                é…ç½®æµ‹è¯•ç»“æœ
              </h4>
              <div
                id="config-test-output"
                class="bg-gray-100 rounded-lg p-4 min-h-[200px]"
              >
                <p class="text-gray-500">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- è‡ªåŠ¨æŠ•é€’æ ‡ç­¾é¡µ -->
        <div id="delivery-content" class="tab-content">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">è‡ªåŠ¨æŠ•é€’åŠŸèƒ½æµ‹è¯•</h3>
            <p class="text-gray-600 mb-6">æµ‹è¯•è‡ªåŠ¨æŠ•é€’ç›¸å…³çš„APIåŠŸèƒ½</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">
                  æŠ•é€’æ§åˆ¶APIæµ‹è¯•
                </h4>
                <button
                  onclick="testDeliveryStatus()"
                  class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  æµ‹è¯•æŠ•é€’çŠ¶æ€API
                </button>
                <button
                  onclick="testStartDelivery()"
                  class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                >
                  æµ‹è¯•å¯åŠ¨æŠ•é€’API
                </button>
                <button
                  onclick="testStopDelivery()"
                  class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                  æµ‹è¯•åœæ­¢æŠ•é€’API
                </button>
              </div>

              <div class="space-y-4">
                <h4 class="text-lg font-medium text-gray-900">
                  æŠ•é€’è®°å½•APIæµ‹è¯•
                </h4>
                <button
                  onclick="testDeliveryRecords()"
                  class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                  æµ‹è¯•æŠ•é€’è®°å½•API
                </button>
                <button
                  onclick="testDeliveryStatistics()"
                  class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
                >
                  æµ‹è¯•æŠ•é€’ç»Ÿè®¡API
                </button>
                <button
                  onclick="testManualDelivery()"
                  class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                >
                  æµ‹è¯•æ‰‹åŠ¨æŠ•é€’API
                </button>
              </div>
            </div>

            <!-- æŠ•é€’æµ‹è¯•ç»“æœ -->
            <div id="delivery-test-results" class="mt-6">
              <h4 class="text-lg font-medium text-gray-900 mb-4">
                æŠ•é€’æµ‹è¯•ç»“æœ
              </h4>
              <div
                id="delivery-test-output"
                class="bg-gray-100 rounded-lg p-4 min-h-[200px]"
              >
                <p class="text-gray-500">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE_URL = 'http://115.190.182.95:8080/api';

      // æ ‡ç­¾é¡µåˆ‡æ¢
      function switchTab(tabName) {
        // éšè—æ‰€æœ‰å†…å®¹
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });

        // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
        document.querySelectorAll('.tab-button').forEach(button => {
          button.classList.remove('border-indigo-500', 'text-indigo-600');
          button.classList.add('border-transparent', 'text-gray-500');
        });

        // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
        document.getElementById(tabName + '-content').classList.add('active');

        // è®¾ç½®é€‰ä¸­çš„æŒ‰é’®æ ·å¼
        const activeButton = document.getElementById(tabName + '-tab');
        activeButton.classList.remove('border-transparent', 'text-gray-500');
        activeButton.classList.add('border-indigo-500', 'text-indigo-600');
      }

      // æ—¥å¿—è¾“å‡ºå‡½æ•°
      function log(message, type = 'info') {
        const output =
          document.getElementById('test-output') ||
          document.getElementById('config-test-output') ||
          document.getElementById('delivery-test-output');
        if (output) {
          const timestamp = new Date().toLocaleTimeString();
          const color =
            type === 'error'
              ? 'text-red-600'
              : type === 'success'
                ? 'text-green-600'
                : type === 'warning'
                  ? 'text-yellow-600'
                  : 'text-gray-700';
          output.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
          output.scrollTop = output.scrollHeight;
        }
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      // æ¸…ç©ºæ—¥å¿—
      function clearLog() {
        const output =
          document.getElementById('test-output') ||
          document.getElementById('config-test-output') ||
          document.getElementById('delivery-test-output');
        if (output) {
          output.innerHTML = '';
        }
      }

      // é€šç”¨APIæµ‹è¯•å‡½æ•°
      async function testApi(endpoint, method = 'GET', data = null) {
        try {
          log(`å¼€å§‹æµ‹è¯• ${method} ${endpoint}`, 'info');
          log(`è¯·æ±‚URL: ${API_BASE_URL}${endpoint}`, 'info');

          const options = {
            method,
            headers: {
              'Content-Type': 'application/json',
            },
            mode: 'cors',
            credentials: 'omit', // ä¸å‘é€å‡­æ®
          };

          if (data) {
            options.body = JSON.stringify(data);
            log(`è¯·æ±‚æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'info');
          }

          log(`è¯·æ±‚é€‰é¡¹: ${JSON.stringify(options, null, 2)}`, 'info');

          const response = await fetch(`${API_BASE_URL}${endpoint}`, options);

          log(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 'info');
          log(`å“åº”URL: ${response.url}`, 'info');
          log(
            `å“åº”å¤´: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`,
            'info'
          );

          if (response.ok) {
            const result = await response.json();
            log(
              `âœ… APIè°ƒç”¨æˆåŠŸ: ${JSON.stringify(result, null, 2)}`,
              'success'
            );
            return result;
          } else {
            const errorText = await response.text();
            log(`âŒ APIè°ƒç”¨å¤±è´¥: ${errorText}`, 'error');
            return null;
          }
        } catch (error) {
          log(`âŒ APIæµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
          log(`é”™è¯¯ç±»å‹: ${error.name}`, 'error');
          log(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
          return null;
        }
      }

      // ç®€å†ç®¡ç†APIæµ‹è¯•
      async function testResumeCheck() {
        clearLog();
        await testApi('/candidate-resume/check');
      }

      async function testResumeInfo() {
        clearLog();
        await testApi('/candidate-resume/info');
      }

      async function testResumeUpload() {
        clearLog();
        log('ç®€å†ä¸Šä¼ æµ‹è¯•éœ€è¦æ–‡ä»¶ï¼Œè·³è¿‡å®é™…æµ‹è¯•', 'warning');
        log('ä¸Šä¼ åŠŸèƒ½éœ€è¦ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ï¼Œè¿™é‡Œåªæµ‹è¯•APIç«¯ç‚¹', 'info');
      }

      async function testFileValidation() {
        clearLog();
        log('æ–‡ä»¶éªŒè¯æµ‹è¯•', 'info');
        log('æ”¯æŒçš„æ–‡ä»¶ç±»å‹: PDF, DOC, DOCX, TXT', 'info');
        log('æ–‡ä»¶å¤§å°é™åˆ¶: 10MB', 'info');
        log('âœ… æ–‡ä»¶éªŒè¯è§„åˆ™å·²é…ç½®', 'success');
      }

      async function testResumeParse() {
        clearLog();
        const testData = {
          resume_text:
            'å¼ ä¸‰\nå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ\n3å¹´å·¥ä½œç»éªŒ\næŠ€èƒ½ï¼šReact, Vue, JavaScript',
        };
        await testApi('/candidate-resume/parse', 'POST', testData);
      }

      async function testResumeDelete() {
        clearLog();
        await testApi('/candidate-resume/delete', 'POST');
      }

      // æŠ•é€’é…ç½®APIæµ‹è¯•
      async function testDeliveryConfig() {
        clearLog();
        await testApi('/delivery/config');
      }

      async function testBossConfig() {
        clearLog();
        await testApi('/delivery/boss-config');
      }

      async function testBlacklistConfig() {
        clearLog();
        await testApi('/delivery/blacklist');
      }

      async function testConfigUpdate() {
        clearLog();
        log('é…ç½®æ›´æ–°æµ‹è¯•éœ€è¦å®Œæ•´é…ç½®æ•°æ®ï¼Œè·³è¿‡å®é™…æµ‹è¯•', 'warning');
        log('æ›´æ–°åŠŸèƒ½éœ€è¦å®Œæ•´çš„é…ç½®å¯¹è±¡', 'info');
      }

      async function testConfigValidation() {
        clearLog();
        log('é…ç½®éªŒè¯æµ‹è¯•', 'info');
        log('âœ… é…ç½®éªŒè¯è§„åˆ™å·²é…ç½®', 'success');
      }

      async function testConfigTest() {
        clearLog();
        log('é…ç½®æµ‹è¯•åŠŸèƒ½éœ€è¦é…ç½®æ•°æ®ï¼Œè·³è¿‡å®é™…æµ‹è¯•', 'warning');
      }

      // è‡ªåŠ¨æŠ•é€’APIæµ‹è¯•
      async function testDeliveryStatus() {
        clearLog();
        await testApi('/delivery/status');
      }

      async function testStartDelivery() {
        clearLog();
        await testApi('/delivery/start', 'POST');
      }

      async function testStopDelivery() {
        clearLog();
        await testApi('/delivery/stop', 'POST');
      }

      async function testDeliveryRecords() {
        clearLog();
        await testApi('/delivery/records?page=0&size=10');
      }

      async function testDeliveryStatistics() {
        clearLog();
        await testApi('/delivery/statistics');
      }

      async function testManualDelivery() {
        clearLog();
        const testData = {
          jobId: 'test-job-123',
          jobTitle: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ',
          companyName: 'æµ‹è¯•å…¬å¸',
          jobUrl: 'https://example.com/job/123',
        };
        await testApi('/delivery/manual', 'POST', testData);
      }

      // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ç®€å†çŠ¶æ€
      window.addEventListener('load', function () {
        console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥ç®€å†çŠ¶æ€...');
        checkResumeStatus();
      });

      // æ£€æŸ¥ç®€å†çŠ¶æ€
      async function checkResumeStatus() {
        const statusDiv = document.getElementById('resume-status');

        try {
          console.log('ğŸ§ª å¼€å§‹æ£€æŸ¥ç®€å†çŠ¶æ€...');
          console.log(
            'API URL: http://115.190.182.95:8080/api/candidate-resume/check'
          );

          const response = await fetch(
            'http://115.190.182.95:8080/api/candidate-resume/check',
            {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
                Origin: 'http://115.190.182.95:3000',
              },
              mode: 'cors',
            }
          );

          console.log('Response status:', response.status);
          console.log('Response URL:', response.url);

          if (response.ok) {
            const data = await response.json();
            console.log('âœ… ç®€å†çŠ¶æ€æ£€æŸ¥æˆåŠŸ:', data);

            if (data.hasResume) {
              statusDiv.innerHTML = `
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                  <div class="flex items-center">
                    <div class="text-green-600 mr-2">âœ…</div>
                    <span class="text-green-800">ç®€å†å·²ä¸Šä¼ ï¼Œå¯ä»¥å¼€å§‹æŠ•é€’</span>
                  </div>
                </div>
              `;
            } else {
              statusDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <div class="flex items-center">
                    <div class="text-blue-600 mr-2">â„¹ï¸</div>
                    <span class="text-blue-800">å°šæœªä¸Šä¼ ç®€å†ï¼Œè¯·å…ˆä¸Šä¼ ç®€å†æ–‡ä»¶</span>
                  </div>
                </div>
              `;
            }
          } else {
            throw new Error(
              `APIè°ƒç”¨å¤±è´¥: ${response.status} ${response.statusText}`
            );
          }
        } catch (error) {
          console.error('âŒ æ£€æŸ¥ç®€å†çŠ¶æ€å¤±è´¥:', error);
          statusDiv.innerHTML = `
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
              <div class="flex items-center">
                <div class="text-red-600 mr-2">âŒ</div>
                <span class="text-red-800">æ£€æŸ¥ç®€å†çŠ¶æ€å¤±è´¥: ${error.message}</span>
              </div>
            </div>
          `;
        }
      }
    </script>
  </body>
</html>
