<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>智投简历 - 智能简历管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .tab-button.active {
        border-bottom-color: #4f46e5;
        color: #4f46e5;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- 顶部导航栏 -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-indigo-600">智投简历</h1>
            <span class="ml-4 text-sm text-gray-500">访客模式</span>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-700">欢迎，访客用户</span>
          </div>
        </div>
      </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- 页面标题 -->
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900">智能简历管理</h2>
        <p class="mt-2 text-gray-600">使用AI智能匹配，找到最适合的职位</p>
      </div>

      <!-- 功能标签页 -->
      <div class="border-b border-gray-200 mb-8">
        <nav class="-mb-px flex space-x-8">
          <button
            id="resume-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-600"
            onclick="switchTab('resume')"
          >
            <span>📄</span>
            <span>简历管理</span>
          </button>
          <button
            id="config-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
            onclick="switchTab('config')"
          >
            <span>⚙️</span>
            <span>投递配置</span>
          </button>
          <button
            id="delivery-tab"
            class="tab-button flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
            onclick="switchTab('delivery')"
          >
            <span>🚀</span>
            <span>自动投递</span>
          </button>
        </nav>
      </div>

      <!-- 标签页内容 -->
      <div>
        <!-- 简历管理标签页 -->
        <div id="resume-content" class="tab-content active">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">简历管理</h3>
            <p class="text-gray-600 mb-6">
              上传、编辑和管理您的简历信息，为智能投递做准备
            </p>

            <!-- 简历状态 -->
            <div id="resume-status" class="mb-6">
              <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div
                    class="animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-2"
                  ></div>
                  <span class="text-yellow-800">正在检查简历状态...</span>
                </div>
              </div>
            </div>

            <!-- 上传简历文件 -->
            <div
              class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center"
            >
              <div class="space-y-4">
                <div class="text-4xl">☁️</div>
                <div>
                  <p class="text-lg font-medium text-gray-900">上传简历文件</p>
                  <p class="text-sm text-gray-500">
                    支持 PDF、DOC、DOCX、TXT 格式，最大 10MB
                  </p>
                </div>
                <div>
                  <input
                    type="file"
                    id="file-input"
                    accept=".pdf,.doc,.docx,.txt"
                    class="hidden"
                    onchange="handleFileUpload(event)"
                  />
                  <button
                    onclick="document.getElementById('file-input').click()"
                    class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
                  >
                    选择文件
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 投递配置标签页 -->
        <div id="config-content" class="tab-content">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">投递配置</h3>
            <p class="text-gray-600 mb-6">配置投递策略和参数，优化投递效果</p>

            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >投递间隔（秒）</label
                >
                <input
                  type="number"
                  value="60"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >每日投递上限</label
                >
                <input
                  type="number"
                  value="50"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >关键词过滤</label
                >
                <textarea
                  rows="3"
                  placeholder="输入要过滤的关键词，每行一个"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                ></textarea>
              </div>

              <button
                class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
              >
                保存配置
              </button>
            </div>
          </div>
        </div>

        <!-- 自动投递标签页 -->
        <div id="delivery-content" class="tab-content">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4">自动投递</h3>
            <p class="text-gray-600 mb-6">
              启动自动投递任务，智能匹配职位并投递简历
            </p>

            <div class="space-y-6">
              <!-- 投递状态 -->
              <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="font-medium text-gray-900 mb-2">投递状态</h4>
                <div class="flex items-center space-x-2">
                  <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                  <span class="text-gray-700">未启动</span>
                </div>
              </div>

              <!-- 投递统计 -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-blue-50 rounded-lg p-4 text-center">
                  <div class="text-2xl font-bold text-blue-600">0</div>
                  <div class="text-sm text-gray-600">今日投递</div>
                </div>
                <div class="bg-green-50 rounded-lg p-4 text-center">
                  <div class="text-2xl font-bold text-green-600">0</div>
                  <div class="text-sm text-gray-600">成功投递</div>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4 text-center">
                  <div class="text-2xl font-bold text-yellow-600">0</div>
                  <div class="text-sm text-gray-600">待处理</div>
                </div>
              </div>

              <!-- 控制按钮 -->
              <div class="flex space-x-4">
                <button
                  class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors"
                >
                  启动投递
                </button>
                <button
                  class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors"
                >
                  停止投递
                </button>
                <button
                  class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors"
                >
                  查看记录
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 标签页切换
      function switchTab(tabName) {
        // 隐藏所有内容
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });

        // 重置所有按钮样式
        document.querySelectorAll('.tab-button').forEach(button => {
          button.classList.remove('border-indigo-500', 'text-indigo-600');
          button.classList.add('border-transparent', 'text-gray-500');
        });

        // 显示选中的内容
        document.getElementById(tabName + '-content').classList.add('active');

        // 设置选中的按钮样式
        const activeButton = document.getElementById(tabName + '-tab');
        activeButton.classList.remove('border-transparent', 'text-gray-500');
        activeButton.classList.add('border-indigo-500', 'text-indigo-600');
      }

      // 检查简历状态
      async function checkResumeStatus() {
        const statusDiv = document.getElementById('resume-status');

        try {
          const response = await fetch(
            'http://115.190.182.95:8080/api/candidate-resume/check',
            {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
                Origin: 'http://115.190.182.95:3000',
              },
              mode: 'cors',
            }
          );

          if (response.ok) {
            const data = await response.json();

            if (data.hasResume) {
              statusDiv.innerHTML = `
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                  <div class="flex items-center">
                    <div class="text-green-600 mr-2">✅</div>
                    <span class="text-green-800">简历已上传，可以开始投递</span>
                  </div>
                </div>
              `;
            } else {
              statusDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <div class="flex items-center">
                    <div class="text-blue-600 mr-2">ℹ️</div>
                    <span class="text-blue-800">尚未上传简历，请先上传简历文件</span>
                  </div>
                </div>
              `;
            }
          } else {
            throw new Error('API调用失败');
          }
        } catch (error) {
          console.error('检查简历状态失败:', error);
          statusDiv.innerHTML = `
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
              <div class="flex items-center">
                <div class="text-red-600 mr-2">❌</div>
                <span class="text-red-800">检查简历状态失败，请稍后重试</span>
              </div>
            </div>
          `;
        }
      }

      // 处理文件上传
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // 验证文件类型
        const allowedTypes = [
          'application/pdf',
          'application/msword',
          'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
          'text/plain',
        ];
        if (
          !allowedTypes.includes(file.type) &&
          !file.name.match(/\.(pdf|doc|docx|txt)$/i)
        ) {
          alert('不支持的文件格式，请上传PDF、DOC、DOCX、TXT文件');
          return;
        }

        // 验证文件大小（10MB）
        if (file.size > 10 * 1024 * 1024) {
          alert('文件大小不能超过10MB');
          return;
        }

        // 显示上传进度
        const statusDiv = document.getElementById('resume-status');
        statusDiv.innerHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
              <span class="text-blue-800">正在上传简历文件: ${file.name}</span>
            </div>
          </div>
        `;

        // 模拟上传（实际应该调用API）
        setTimeout(() => {
          statusDiv.innerHTML = `
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
              <div class="flex items-center">
                <div class="text-green-600 mr-2">✅</div>
                <span class="text-green-800">简历上传成功！</span>
              </div>
            </div>
          `;
        }, 2000);
      }

      // 页面加载完成后检查简历状态
      window.addEventListener('load', function () {
        console.log('页面加载完成，开始检查简历状态...');
        checkResumeStatus();
      });
    </script>
  </body>
</html>
