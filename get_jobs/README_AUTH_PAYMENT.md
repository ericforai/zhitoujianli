# æ™ºæŠ•ç®€å† - èº«ä»½è®¤è¯ä¸æ”¯ä»˜ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

> ğŸ“… æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2025å¹´9æœˆ30æ—¥  
> ğŸ¯ ç›®æ ‡ï¼šä¸ºé¡¹ç›®æä¾›å®‰å…¨ã€ç®€å•ã€æˆç†Ÿçš„æ³¨å†Œç™»å½•å’Œæ”¯ä»˜è§£å†³æ–¹æ¡ˆ

---

## ğŸ“‹ ç›®å½•

- [æ–¹æ¡ˆæ¦‚è¿°](#æ–¹æ¡ˆæ¦‚è¿°)
- [æ¨èæ–¹æ¡ˆå¯¹æ¯”](#æ¨èæ–¹æ¡ˆå¯¹æ¯”)
- [æ–¹æ¡ˆAï¼šAuthingï¼ˆæ¨èï¼‰](#æ–¹æ¡ˆa-authingæ¨è)
- [æ–¹æ¡ˆBï¼šå¼€æºè‡ªå»ºæ–¹æ¡ˆ](#æ–¹æ¡ˆb-å¼€æºè‡ªå»ºæ–¹æ¡ˆ)
- [æ”¯ä»˜é›†æˆæ–¹æ¡ˆ](#æ”¯ä»˜é›†æˆæ–¹æ¡ˆ)
- [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## ğŸ¯ æ–¹æ¡ˆæ¦‚è¿°

### å½“å‰é—®é¢˜
- âŒ åå°ç®¡ç†æ— ä»»ä½•ç™»å½•ä¿æŠ¤
- âŒ æ‰€æœ‰APIæ¥å£å¯è¢«å…¬å¼€è®¿é—®
- âŒ ç”¨æˆ·æ•°æ®æ— æƒé™éš”ç¦»
- âŒ æ— æ”¯ä»˜åŠŸèƒ½ï¼Œæ— æ³•å•†ä¸šåŒ–

### è§£å†³ç›®æ ‡
- âœ… æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€æ‰‹æœºå·ã€é‚®ç®±ç™»å½•
- âœ… ä½¿ç”¨æˆç†Ÿæ–¹æ¡ˆï¼Œä¸ä»å¤´å¼€å‘
- âœ… ä¿è¯æ•°æ®å®‰å…¨å’Œåˆè§„æ€§
- âœ… é›†æˆæ”¯ä»˜åŠŸèƒ½ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ï¼‰
- âœ… å¿«é€Ÿä¸Šçº¿ï¼Œç»´æŠ¤æˆæœ¬ä½

---

## ğŸ† æ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | å¼€å‘å‘¨æœŸ | æˆæœ¬ | æ¨èåº¦ |
|------|------|------|----------|------|--------|
| **Authing** | å¼€ç®±å³ç”¨ï¼Œå›½å†…æœåŠ¡å¿«ï¼Œä¸­æ–‡æ”¯æŒå¥½ | æœ‰å…è´¹é¢åº¦é™åˆ¶ | 1-3å¤© | å…è´¹ç‰ˆå¤Ÿç”¨ | â­â­â­â­â­ |
| **Keycloak** | å®Œå…¨å¼€æºå…è´¹ï¼ŒåŠŸèƒ½å¼ºå¤§ | éœ€è¦è‡ªå·±éƒ¨ç½²ç»´æŠ¤ | 3-5å¤© | æœåŠ¡å™¨æˆæœ¬ | â­â­â­â­ |
| **Spring Security + è‡ªå¼€å‘** | å®Œå…¨è‡ªä¸»æ§åˆ¶ | å¼€å‘å‘¨æœŸé•¿ï¼Œå®¹æ˜“å‡ºç°å®‰å…¨æ¼æ´ | 7-14å¤© | äººåŠ›æˆæœ¬é«˜ | â­â­ |
| **Supabase Auth** | å¼€æºï¼ŒåŠŸèƒ½å®Œæ•´ | å›½å†…è®¿é—®è¾ƒæ…¢ | 2-4å¤© | æœ‰å…è´¹é¢åº¦ | â­â­â­ |

---

## ğŸ¥‡ æ–¹æ¡ˆAï¼šAuthingï¼ˆæ¨èï¼‰

### ä¸ºä»€ä¹ˆé€‰æ‹©Authingï¼Ÿ

**Authing** æ˜¯å›½å†…æœ€ä¸“ä¸šçš„èº«ä»½è®¤è¯äº‘æœåŠ¡ï¼ˆä¸­å›½ç‰ˆAuth0ï¼‰ï¼Œä¸“ä¸ºä¸­å›½å¼€å‘è€…è®¾è®¡ï¼š

âœ… **å¼€ç®±å³ç”¨**ï¼šæ— éœ€å¼€å‘ç™»å½•é¡µé¢ï¼Œæä¾›ç°æˆçš„UIç»„ä»¶  
âœ… **å…¨ç™»å½•æ–¹å¼**ï¼šæ”¯æŒå¾®ä¿¡ã€æ”¯ä»˜å®ã€æ‰‹æœºå·ã€é‚®ç®±ã€GitHubç­‰20+ç™»å½•æ–¹å¼  
âœ… **å®‰å…¨åˆè§„**ï¼šç¬¦åˆç­‰ä¿2.0è¦æ±‚ï¼Œé€šè¿‡ISO27001è®¤è¯  
âœ… **å…è´¹é¢åº¦**ï¼šæ¯æœˆ8000 MAUï¼ˆæœˆæ´»ç”¨æˆ·ï¼‰å…è´¹  
âœ… **ä¸­æ–‡æ”¯æŒ**ï¼šå®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£å’ŒæŠ€æœ¯æ”¯æŒ  
âœ… **å¿«é€Ÿé›†æˆ**ï¼šSpring Bootå®˜æ–¹SDKï¼Œ10åˆ†é’Ÿé›†æˆå®Œæˆ

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ç±»åˆ« | å…·ä½“åŠŸèƒ½ |
|---------|---------|
| **ç¤¾äº¤ç™»å½•** | å¾®ä¿¡æ‰«ç /ç½‘é¡µæˆæƒã€æ”¯ä»˜å®ç™»å½•ã€QQç™»å½•ã€å¾®åšç™»å½• |
| **ä¼ ç»Ÿç™»å½•** | æ‰‹æœºå·éªŒè¯ç ã€é‚®ç®±å¯†ç ã€é‚®ç®±éªŒè¯ç  |
| **ä¼ä¸šç™»å½•** | ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€é£ä¹¦ |
| **å›½é™…ç™»å½•** | Googleã€GitHubã€Appleã€Facebook |
| **å®‰å…¨åŠŸèƒ½** | MFAå¤šå› ç´ è®¤è¯ã€è®¾å¤‡æŒ‡çº¹ã€ç™»å½•é£æ§ã€è¡Œä¸ºåˆ†æ |
| **æƒé™ç®¡ç†** | RBACè§’è‰²æƒé™ã€ABACå±æ€§æƒé™ã€ç»„ç»‡æ¶æ„ç®¡ç† |

### é›†æˆæ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šæ³¨å†ŒAuthingè´¦å·

1. è®¿é—® [https://authing.cn/](https://authing.cn/) æ³¨å†Œè´¦å·
2. åˆ›å»ºç”¨æˆ·æ± ï¼ˆUser Poolï¼‰
3. è·å–é…ç½®ä¿¡æ¯ï¼š
   - `User Pool ID`ï¼ˆç”¨æˆ·æ± IDï¼‰
   - `App ID`ï¼ˆåº”ç”¨IDï¼‰
   - `App Secret`ï¼ˆåº”ç”¨å¯†é’¥ï¼‰

#### ç¬¬äºŒæ­¥ï¼šMavenä¾èµ–é…ç½®

åœ¨ `get_jobs/pom.xml` ä¸­æ·»åŠ ä¾èµ–ï¼š

```xml
<!-- Authing Java SDK -->
<dependency>
    <groupId>cn.authing</groupId>
    <artifactId>authing-java-sdk</artifactId>
    <version>3.0.0</version>
</dependency>

<!-- JWT Tokenå¤„ç† -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.12.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.12.5</version>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.12.5</version>
    <scope>runtime</scope>
</dependency>

<!-- Spring Security -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

#### ç¬¬ä¸‰æ­¥ï¼šç¯å¢ƒå˜é‡é…ç½®

åœ¨ `src/main/resources/.env` ä¸­æ·»åŠ ï¼š

```bash
# Authingé…ç½®
AUTHING_USER_POOL_ID=your_user_pool_id
AUTHING_APP_ID=your_app_id
AUTHING_APP_SECRET=your_app_secret
AUTHING_APP_HOST=https://your-domain.authing.cn

# JWTé…ç½®
JWT_SECRET=your_super_secret_jwt_key_change_in_production
JWT_EXPIRATION=86400000

# åŸæœ‰é…ç½®ä¿æŒä¸å˜
HOOK_URL=...
BASE_URL=...
```

#### ç¬¬å››æ­¥ï¼šä»£ç é›†æˆæ¶æ„

```
get_jobs/
â””â”€â”€ src/main/java/
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ AuthingConfig.java          # Authingé…ç½®ç±»
    â”‚   â””â”€â”€ SecurityConfig.java         # Spring Securityé…ç½®
    â”œâ”€â”€ security/
    â”‚   â”œâ”€â”€ JwtTokenProvider.java       # JWTä»¤ç‰Œç”Ÿæˆä¸éªŒè¯
    â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java # JWTè¿‡æ»¤å™¨
    â”‚   â””â”€â”€ AuthenticationService.java   # è®¤è¯æœåŠ¡
    â”œâ”€â”€ controller/
    â”‚   â”œâ”€â”€ AuthController.java         # è®¤è¯æ§åˆ¶å™¨ï¼ˆç™»å½•/æ³¨å†Œ/ç™»å‡ºï¼‰
    â”‚   â””â”€â”€ WebController.java          # ç°æœ‰æ§åˆ¶å™¨ï¼ˆæ·»åŠ æƒé™ä¿æŠ¤ï¼‰
    â”œâ”€â”€ model/
    â”‚   â””â”€â”€ User.java                   # ç”¨æˆ·æ¨¡å‹
    â””â”€â”€ interceptor/
        â””â”€â”€ AuthInterceptor.java        # è®¤è¯æ‹¦æˆªå™¨
```

#### ç¬¬äº”æ­¥ï¼šä»£ç å®ç°ç¤ºä¾‹

**1. Authingé…ç½®ç±»**

```java
package config;

import cn.authing.sdk.java.client.ManagementClient;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AuthingConfig {
    
    @Value("${authing.userPoolId}")
    private String userPoolId;
    
    @Value("${authing.appSecret}")
    private String appSecret;
    
    @Bean
    public ManagementClient managementClient() {
        ManagementClient client = new ManagementClient(userPoolId, appSecret);
        return client;
    }
}
```

**2. è®¤è¯æ§åˆ¶å™¨**

```java
package controller;

import cn.authing.sdk.java.client.AuthenticationClient;
import cn.authing.sdk.java.dto.*;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/api/auth")
@Slf4j
public class AuthController {

    @Value("${authing.appId}")
    private String appId;

    /**
     * æ‰‹æœºå·éªŒè¯ç ç™»å½•
     */
    @PostMapping("/login/phone")
    public ResponseEntity<?> loginByPhone(@RequestBody Map<String, String> request) {
        try {
            String phone = request.get("phone");
            String code = request.get("code");
            
            AuthenticationClient client = new AuthenticationClient();
            client.setAppId(appId);
            
            SignInByPhonePassCodeDto dto = new SignInByPhonePassCodeDto();
            dto.setPhoneNumber(phone);
            dto.setPassCode(code);
            
            LoginTokenRespDto result = client.signInByPhonePassCode(dto);
            
            Map<String, Object> response = new HashMap<>();
            response.put("success", true);
            response.put("token", result.getAccessToken());
            response.put("user", result.getData());
            
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("æ‰‹æœºå·ç™»å½•å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * å‘é€æ‰‹æœºéªŒè¯ç 
     */
    @PostMapping("/send-code")
    public ResponseEntity<?> sendPhoneCode(@RequestBody Map<String, String> request) {
        try {
            String phone = request.get("phone");
            
            AuthenticationClient client = new AuthenticationClient();
            client.setAppId(appId);
            
            SendSMSDto dto = new SendSMSDto();
            dto.setPhoneNumber(phone);
            
            SendSMSRespDto result = client.sendSms(dto);
            
            return ResponseEntity.ok(Map.of("success", true, "message", "éªŒè¯ç å·²å‘é€"));
        } catch (Exception e) {
            log.error("å‘é€éªŒè¯ç å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * é‚®ç®±å¯†ç ç™»å½•
     */
    @PostMapping("/login/email")
    public ResponseEntity<?> loginByEmail(@RequestBody Map<String, String> request) {
        try {
            String email = request.get("email");
            String password = request.get("password");
            
            AuthenticationClient client = new AuthenticationClient();
            client.setAppId(appId);
            
            SignInByEmailPasswordDto dto = new SignInByEmailPasswordDto();
            dto.setEmail(email);
            dto.setPassword(password);
            
            LoginTokenRespDto result = client.signInByEmailPassword(dto);
            
            Map<String, Object> response = new HashMap<>();
            response.put("success", true);
            response.put("token", result.getAccessToken());
            response.put("user", result.getData());
            
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("é‚®ç®±ç™»å½•å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * å¾®ä¿¡æ‰«ç ç™»å½•
     * å‰ç«¯è°ƒç”¨Authingæä¾›çš„å¾®ä¿¡ç™»å½•ç»„ä»¶
     */
    @GetMapping("/login/wechat/callback")
    public ResponseEntity<?> wechatCallback(@RequestParam String code) {
        try {
            AuthenticationClient client = new AuthenticationClient();
            client.setAppId(appId);
            
            // Authingä¼šè‡ªåŠ¨å¤„ç†å¾®ä¿¡OAuthæµç¨‹
            SignInByWechatAuthCodeDto dto = new SignInByWechatAuthCodeDto();
            dto.setCode(code);
            
            LoginTokenRespDto result = client.signInByWechatAuthCode(dto);
            
            Map<String, Object> response = new HashMap<>();
            response.put("success", true);
            response.put("token", result.getAccessToken());
            response.put("user", result.getData());
            
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("å¾®ä¿¡ç™»å½•å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * æ”¯ä»˜å®ç™»å½•
     * å‰ç«¯è°ƒç”¨Authingæä¾›çš„æ”¯ä»˜å®ç™»å½•ç»„ä»¶
     */
    @GetMapping("/login/alipay/callback")
    public ResponseEntity<?> alipayCallback(@RequestParam String code) {
        try {
            AuthenticationClient client = new AuthenticationClient();
            client.setAppId(appId);
            
            // Authingä¼šè‡ªåŠ¨å¤„ç†æ”¯ä»˜å®OAuthæµç¨‹
            SignInByAlipayAuthCodeDto dto = new SignInByAlipayAuthCodeDto();
            dto.setCode(code);
            
            LoginTokenRespDto result = client.signInByAlipayAuthCode(dto);
            
            Map<String, Object> response = new HashMap<>();
            response.put("success", true);
            response.put("token", result.getAccessToken());
            response.put("user", result.getData());
            
            return ResponseEntity.ok(response);
        } catch (Exception e) {
            log.error("æ”¯ä»˜å®ç™»å½•å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
     */
    @GetMapping("/user/info")
    public ResponseEntity<?> getUserInfo(@RequestHeader("Authorization") String token) {
        try {
            // ç§»é™¤ "Bearer " å‰ç¼€
            token = token.replace("Bearer ", "");
            
            AuthenticationClient client = new AuthenticationClient();
            client.setAccessToken(token);
            
            UserSingleRespDto user = client.getProfile();
            
            return ResponseEntity.ok(Map.of("success", true, "user", user.getData()));
        } catch (Exception e) {
            log.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥", e);
            return ResponseEntity.status(401)
                .body(Map.of("success", false, "message", "æœªæˆæƒ"));
        }
    }

    /**
     * ç™»å‡º
     */
    @PostMapping("/logout")
    public ResponseEntity<?> logout(@RequestHeader("Authorization") String token) {
        try {
            token = token.replace("Bearer ", "");
            
            AuthenticationClient client = new AuthenticationClient();
            client.setAccessToken(token);
            
            client.revokeToken(new RevokeTokenDto().setToken(token));
            
            return ResponseEntity.ok(Map.of("success", true, "message", "ç™»å‡ºæˆåŠŸ"));
        } catch (Exception e) {
            log.error("ç™»å‡ºå¤±è´¥", e);
            return ResponseEntity.ok(Map.of("success", true, "message", "ç™»å‡ºæˆåŠŸ"));
        }
    }
}
```

**3. Spring Securityé…ç½®**

```java
package config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import security.JwtAuthenticationFilter;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable()) // APIé¡¹ç›®ç¦ç”¨CSRF
            .cors(cors -> cors.configure(http)) // å…è®¸è·¨åŸŸ
            .sessionManagement(session -> 
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)) // æ— çŠ¶æ€ä¼šè¯
            .authorizeHttpRequests(auth -> auth
                // å…¬å¼€è®¿é—®çš„æ¥å£
                .requestMatchers(
                    "/api/auth/**",           // è®¤è¯ç›¸å…³æ¥å£
                    "/login",                 // ç™»å½•é¡µé¢
                    "/register",              // æ³¨å†Œé¡µé¢
                    "/",                      // é¦–é¡µ
                    "/static/**",             // é™æ€èµ„æº
                    "/favicon.ico"            // ç½‘ç«™å›¾æ ‡
                ).permitAll()
                // å…¶ä»–æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯
                .anyRequest().authenticated()
            )
            .addFilterBefore(jwtAuthenticationFilter(), 
                UsernamePasswordAuthenticationFilter.class);
        
        return http.build();
    }

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }
}
```

**4. JWTè®¤è¯è¿‡æ»¤å™¨**

```java
package security;

import cn.authing.sdk.java.client.AuthenticationClient;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;

@Slf4j
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                    HttpServletResponse response, 
                                    FilterChain filterChain) 
            throws ServletException, IOException {
        
        try {
            // ä»è¯·æ±‚å¤´è·å–Token
            String token = getJwtFromRequest(request);
            
            if (token != null && !token.isEmpty()) {
                // éªŒè¯Token
                AuthenticationClient client = new AuthenticationClient();
                client.setAccessToken(token);
                
                // è·å–ç”¨æˆ·ä¿¡æ¯
                var userInfo = client.getProfile();
                
                if (userInfo != null && userInfo.getData() != null) {
                    // è®¾ç½®è®¤è¯ä¿¡æ¯
                    UsernamePasswordAuthenticationToken authentication = 
                        new UsernamePasswordAuthenticationToken(
                            userInfo.getData(), null, null);
                    authentication.setDetails(
                        new WebAuthenticationDetailsSource().buildDetails(request));
                    
                    SecurityContextHolder.getContext().setAuthentication(authentication);
                }
            }
        } catch (Exception e) {
            log.error("JWTè®¤è¯å¤±è´¥", e);
        }
        
        filterChain.doFilter(request, response);
    }

    private String getJwtFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
}
```

#### ç¬¬å…­æ­¥ï¼šå‰ç«¯é›†æˆ

åœ¨ `zhitoujianli-website/src` æˆ– Reactå‰ç«¯é¡¹ç›®ä¸­ï¼š

**å®‰è£…Authing SDK**ï¼š
```bash
npm install @authing/web
```

**ç™»å½•ç»„ä»¶ç¤ºä¾‹**ï¼š
```tsx
// src/components/Login.tsx
import React, { useEffect } from 'react';
import { Authing } from '@authing/web';

const Login: React.FC = () => {
  useEffect(() => {
    // åˆå§‹åŒ–Authing
    const authing = new Authing({
      domain: 'https://your-domain.authing.cn',
      appId: 'your_app_id',
      redirectUri: 'http://localhost:3000/callback',
    });

    // æ¸²æŸ“ç™»å½•ç»„ä»¶
    authing.start('#authing-container');
  }, []);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="max-w-md w-full">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold">æ™ºæŠ•ç®€å†</h1>
          <p className="text-gray-600 mt-2">æ™ºèƒ½åŒ–æ±‚èŒæŠ•é€’å¹³å°</p>
        </div>
        <div id="authing-container"></div>
      </div>
    </div>
  );
};

export default Login;
```

### Authingæ§åˆ¶å°é…ç½®

ç™»å½• [Authingæ§åˆ¶å°](https://console.authing.cn/)ï¼š

1. **é…ç½®ç¤¾äº¤ç™»å½•**ï¼š
   - å¾®ä¿¡æ‰«ç ç™»å½•ï¼šåœ¨"ç¤¾äº¤åŒ–ç™»å½•"ä¸­æ·»åŠ å¾®ä¿¡ç½‘é¡µæˆæƒ
   - æ”¯ä»˜å®ç™»å½•ï¼šæ·»åŠ æ”¯ä»˜å®åº”ç”¨ï¼Œé…ç½®AppIDå’Œç§é’¥
   - å…¶ä»–å¹³å°ï¼šæ ¹æ®éœ€è¦æ·»åŠ 

2. **é…ç½®å®‰å…¨ç­–ç•¥**ï¼š
   - å¯ç”¨MFAå¤šå› ç´ è®¤è¯
   - è®¾ç½®å¯†ç å¼ºåº¦ç­–ç•¥
   - é…ç½®ç™»å½•å¤±è´¥é”å®šç­–ç•¥
   - å¯ç”¨è®¾å¤‡æŒ‡çº¹è¯†åˆ«

3. **é…ç½®æƒé™è§„åˆ™**ï¼š
   - åˆ›å»ºè§’è‰²ï¼šæ™®é€šç”¨æˆ·ã€VIPç”¨æˆ·ã€ç®¡ç†å‘˜
   - è®¾ç½®èµ„æºæƒé™ï¼šå“ªäº›APIéœ€è¦å“ªäº›è§’è‰²æ‰èƒ½è®¿é—®

### è´¹ç”¨è¯´æ˜

| æ–¹æ¡ˆ | å…è´¹é¢åº¦ | ä»˜è´¹ä»·æ ¼ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| **å…è´¹ç‰ˆ** | 8000 MAU/æœˆ | 0å…ƒ | å°å‹é¡¹ç›®ã€ä¸ªäººå¼€å‘ |
| **ä¸“ä¸šç‰ˆ** | 20000 MAU/æœˆ | 1680å…ƒ/æœˆ | ä¸­å°ä¼ä¸š |
| **ä¼ä¸šç‰ˆ** | è‡ªå®šä¹‰ | è”ç³»é”€å”® | å¤§å‹ä¼ä¸š |

> ğŸ’¡ **MAUï¼ˆæœˆæ´»ç”¨æˆ·ï¼‰**: ä¸€ä¸ªæœˆå†…è‡³å°‘ç™»å½•ä¸€æ¬¡çš„ç‹¬ç«‹ç”¨æˆ·æ•°  
> å¯¹äºåˆåˆ›é¡¹ç›®ï¼Œå…è´¹ç‰ˆçš„8000 MAUå®Œå…¨å¤Ÿç”¨

### ä¼˜åŠ¿æ€»ç»“

âœ… **10åˆ†é’Ÿé›†æˆ**ï¼šæ— éœ€å¼€å‘ç™»å½•é¡µé¢ï¼Œå¤åˆ¶ç²˜è´´å³å¯  
âœ… **é›¶è¿ç»´æˆæœ¬**ï¼šäº‘æœåŠ¡ï¼Œæ— éœ€è‡ªå·±éƒ¨ç½²å’Œç»´æŠ¤  
âœ… **å®‰å…¨å¯é **ï¼šä¸“ä¸šå›¢é˜Ÿç»´æŠ¤ï¼Œç¬¦åˆå›½å®¶å®‰å…¨æ ‡å‡†  
âœ… **ä¸°å¯ŒåŠŸèƒ½**ï¼š20+ç™»å½•æ–¹å¼ï¼Œå¼€ç®±å³ç”¨  
âœ… **æŠ€æœ¯æ”¯æŒ**ï¼šä¸­æ–‡æ–‡æ¡£+æŠ€æœ¯æ”¯æŒç¾¤

---

## ğŸ¥ˆ æ–¹æ¡ˆBï¼šå¼€æºè‡ªå»ºæ–¹æ¡ˆï¼ˆKeycloakï¼‰

### é€‚ç”¨åœºæ™¯

- âœ… éœ€è¦å®Œå…¨è‡ªä¸»æ§åˆ¶ç”¨æˆ·æ•°æ®
- âœ… é•¿æœŸé¡¹ç›®ï¼Œæœ‰ä¸“äººè¿ç»´
- âœ… æœ‰æœåŠ¡å™¨èµ„æº
- âŒ ä¸é€‚åˆå¿«é€Ÿä¸Šçº¿çš„é¡¹ç›®

### Keycloakç®€ä»‹

**Keycloak** æ˜¯Red Hatå¼€æºçš„ä¼ä¸šçº§èº«ä»½è®¤è¯å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼š

- ğŸŒ å…¨çƒå¹¿æ³›ä½¿ç”¨ï¼Œç¤¾åŒºæ´»è·ƒ
- ğŸ” æ”¯æŒOAuth 2.0ã€OpenID Connectã€SAML 2.0
- ğŸ¨ æä¾›å¯å®šåˆ¶çš„ç™»å½•é¡µé¢
- ğŸ“± æ”¯æŒç¤¾äº¤ç™»å½•ã€MFAã€SSO

### å¿«é€Ÿéƒ¨ç½²ï¼ˆDockeræ–¹å¼ï¼‰

#### ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨Docker Composeéƒ¨ç½²Keycloak

åˆ›å»º `get_jobs/docker-compose.keycloak.yml`ï¼š

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: keycloak
      POSTGRES_USER: keycloak
      POSTGRES_PASSWORD: your_password_here
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - keycloak-network

  keycloak:
    image: quay.io/keycloak/keycloak:23.0
    command: start-dev
    environment:
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://postgres:5432/keycloak
      KC_DB_USERNAME: keycloak
      KC_DB_PASSWORD: your_password_here
      KC_HOSTNAME: localhost
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin123
    ports:
      - "8180:8080"  # é¿å…ä¸Spring Bootç«¯å£å†²çª
    depends_on:
      - postgres
    networks:
      - keycloak-network

volumes:
  postgres_data:

networks:
  keycloak-network:
    driver: bridge
```

**å¯åŠ¨å‘½ä»¤**ï¼š
```bash
cd /Users/user/autoresume/get_jobs
docker-compose -f docker-compose.keycloak.yml up -d
```

è®¿é—®ç®¡ç†æ§åˆ¶å°ï¼š`http://localhost:8180`ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadmin123ï¼‰

#### ç¬¬äºŒæ­¥ï¼šMavenä¾èµ–

```xml
<!-- Keycloak Spring Boot Adapter -->
<dependency>
    <groupId>org.keycloak</groupId>
    <artifactId>keycloak-spring-boot-starter</artifactId>
    <version>23.0.0</version>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

#### ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶

åœ¨ `src/main/resources/application.yml` ä¸­æ·»åŠ ï¼š

```yaml
keycloak:
  realm: zhitoujianli
  auth-server-url: http://localhost:8180
  ssl-required: external
  resource: zhitoujianli-backend
  credentials:
    secret: your_client_secret_from_keycloak
  use-resource-role-mappings: true
  bearer-only: true
```

#### ç¬¬å››æ­¥ï¼šKeycloaké…ç½®æ­¥éª¤

1. **åˆ›å»ºRealm**ï¼šç™»å½•æ§åˆ¶å° â†’ åˆ›å»ºæ–°Realmï¼ˆåç§°ï¼šzhitoujianliï¼‰
2. **åˆ›å»ºClient**ï¼š
   - Client ID: `zhitoujianli-backend`
   - Client Protocol: openid-connect
   - Access Type: confidential
   - Valid Redirect URIs: `http://localhost:3000/*`
3. **é…ç½®ç¤¾äº¤ç™»å½•**ï¼š
   - Identity Providers â†’ æ·»åŠ  WeChat/Alipay/GitHubç­‰
   - éœ€è¦åœ¨å„å¹³å°ç”³è¯·OAuthåº”ç”¨å¹¶é…ç½®Client ID/Secret
4. **é…ç½®æ‰‹æœºå·ç™»å½•**ï¼š
   - éœ€è¦é›†æˆçŸ­ä¿¡æœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘SMSã€è…¾è®¯äº‘SMSç­‰ï¼‰

### ä¼˜åŠ£åŠ¿å¯¹æ¯”

| ç»´åº¦ | Authing | Keycloak |
|------|---------|----------|
| éƒ¨ç½²å¤æ‚åº¦ | â­ æç®€ | â­â­â­ éœ€è¦Docker/K8s |
| å¼€å‘å‘¨æœŸ | 1-3å¤© | 3-7å¤© |
| è¿ç»´æˆæœ¬ | æ—  | éœ€è¦ä¸“äººç»´æŠ¤ |
| åŠŸèƒ½å®Œæ•´åº¦ | â­â­â­â­â­ | â­â­â­â­â­ |
| å®šåˆ¶åŒ–ç¨‹åº¦ | â­â­â­ | â­â­â­â­â­ |
| æˆæœ¬ | å…è´¹ç‰ˆå¤Ÿç”¨ | æœåŠ¡å™¨+äººåŠ›æˆæœ¬ |
| å›½å†…è®¿é—®é€Ÿåº¦ | â­â­â­â­â­ | â­â­â­â­ |

---

## ğŸ’³ æ”¯ä»˜é›†æˆæ–¹æ¡ˆ

### æ¨èæ–¹æ¡ˆï¼šå®˜æ–¹SDKç›´æ¥é›†æˆ

å¯¹äºå›½å†…é¡¹ç›®ï¼Œæ¨èç›´æ¥é›†æˆå¾®ä¿¡æ”¯ä»˜å’Œæ”¯ä»˜å®å®˜æ–¹SDKï¼Œæ— éœ€ç¬¬ä¸‰æ–¹èšåˆæ”¯ä»˜ï¼š

#### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåº¦ |
|------|------|------|--------|
| **å®˜æ–¹SDK** | è´¹ç‡æœ€ä½(0.6%)ï¼Œç›´æ¥åˆ°è´¦ï¼Œç¨³å®šå¯é  | éœ€è¦åˆ†åˆ«å¯¹æ¥ä¸¤ä¸ªå¹³å° | â­â­â­â­â­ |
| **Ping++** | ç»Ÿä¸€APIï¼Œæ”¯æŒå¤šæ¸ é“ | é¢å¤–æ”¶è´¹(çº¦0.2%+) | â­â­â­â­ |
| **BeeCloud** | è´¹ç”¨é€æ˜ï¼Œæ–‡æ¡£å®Œå–„ | é¢å¤–æ”¶è´¹ | â­â­â­ |
| **Stripe** | å›½é™…åŒ–é¦–é€‰ï¼ŒåŠŸèƒ½å¼ºå¤§ | å›½å†…æ”¯æŒå·®ï¼Œè´¹ç‡é«˜(2.9%+) | â­ |

### å¾®ä¿¡æ”¯ä»˜é›†æˆ

#### ç¬¬ä¸€æ­¥ï¼šç”³è¯·å¾®ä¿¡æ”¯ä»˜å•†æˆ·å·

1. è®¿é—® [å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°](https://pay.weixin.qq.com/)
2. ç”³è¯·æˆä¸ºå•†æˆ·ï¼ˆéœ€è¦è¥ä¸šæ‰§ç…§ï¼‰
3. è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š
   - `å•†æˆ·å·ï¼ˆmchIdï¼‰`
   - `APIå¯†é’¥ï¼ˆapiKeyï¼‰`
   - `APIè¯ä¹¦ï¼ˆapiclient_cert.p12ï¼‰`

#### ç¬¬äºŒæ­¥ï¼šMavenä¾èµ–

```xml
<!-- å¾®ä¿¡æ”¯ä»˜SDK -->
<dependency>
    <groupId>com.github.wechatpay-apiv3</groupId>
    <artifactId>wechatpay-java</artifactId>
    <version>0.2.12</version>
</dependency>
```

#### ç¬¬ä¸‰æ­¥ï¼šé…ç½®

åœ¨ `.env` ä¸­æ·»åŠ ï¼š

```bash
# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_PAY_MERCHANT_ID=your_merchant_id
WECHAT_PAY_API_KEY=your_api_key
WECHAT_PAY_CERT_PATH=src/main/resources/apiclient_cert.p12
WECHAT_PAY_NOTIFY_URL=https://yourdomain.com/api/payment/wechat/notify
```

#### ç¬¬å››æ­¥ï¼šæ”¯ä»˜æ§åˆ¶å™¨

```java
package controller;

import com.wechat.pay.java.core.Config;
import com.wechat.pay.java.core.RSAAutoCertificateConfig;
import com.wechat.pay.java.service.payments.nativepay.NativePayService;
import com.wechat.pay.java.service.payments.nativepay.model.*;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/api/payment")
@Slf4j
public class PaymentController {

    @Value("${wechat.pay.merchantId}")
    private String merchantId;

    @Value("${wechat.pay.apiKey}")
    private String apiKey;

    /**
     * åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•ï¼ˆNativeæ‰«ç æ”¯ä»˜ï¼‰
     */
    @PostMapping("/wechat/create")
    public ResponseEntity<?> createWechatPayment(@RequestBody Map<String, Object> request) {
        try {
            // è®¢å•ä¿¡æ¯
            String orderNo = generateOrderNo();
            String description = (String) request.get("description");
            Integer amount = (Integer) request.get("amount"); // å•ä½ï¼šåˆ†
            
            // é…ç½®å¾®ä¿¡æ”¯ä»˜
            Config config = new RSAAutoCertificateConfig.Builder()
                .merchantId(merchantId)
                .privateKeyFromPath("src/main/resources/apiclient_key.pem")
                .merchantSerialNumber("merchant_serial_number")
                .apiV3Key(apiKey)
                .build();
            
            NativePayService service = new NativePayService.Builder().config(config).build();
            
            // åˆ›å»ºæ”¯ä»˜è¯·æ±‚
            PrepayRequest payRequest = new PrepayRequest();
            Amount amountObj = new Amount();
            amountObj.setTotal(amount);
            payRequest.setAmount(amountObj);
            payRequest.setAppid("your_wechat_appid");
            payRequest.setMchid(merchantId);
            payRequest.setDescription(description);
            payRequest.setNotifyUrl("https://yourdomain.com/api/payment/wechat/notify");
            payRequest.setOutTradeNo(orderNo);
            
            // è°ƒç”¨ä¸‹å•æ–¹æ³•ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•
            PrepayResponse response = service.prepay(payRequest);
            
            Map<String, Object> result = new HashMap<>();
            result.put("success", true);
            result.put("orderNo", orderNo);
            result.put("codeUrl", response.getCodeUrl()); // äºŒç»´ç URL
            
            return ResponseEntity.ok(result);
        } catch (Exception e) {
            log.error("åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•å¤±è´¥", e);
            return ResponseEntity.badRequest()
                .body(Map.of("success", false, "message", e.getMessage()));
        }
    }

    /**
     * å¾®ä¿¡æ”¯ä»˜å›è°ƒ
     */
    @PostMapping("/wechat/notify")
    public ResponseEntity<String> wechatNotify(@RequestBody String requestBody) {
        try {
            log.info("æ”¶åˆ°å¾®ä¿¡æ”¯ä»˜å›è°ƒ: {}", requestBody);
            
            // TODO: éªŒè¯ç­¾å
            // TODO: å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆæ›´æ–°è®¢å•çŠ¶æ€ã€å¼€é€šä¼šå‘˜ç­‰ï¼‰
            
            // è¿”å›æˆåŠŸå“åº”
            return ResponseEntity.ok("{\"code\": \"SUCCESS\", \"message\": \"æˆåŠŸ\"}");
        } catch (Exception e) {
            log.error("å¤„ç†å¾®ä¿¡æ”¯ä»˜å›è°ƒå¤±è´¥", e);
            return ResponseEntity.badRequest().body("{\"code\": \"FAIL\", \"message\": \"å¤±è´¥\"}");
        }
    }

    private String generateOrderNo() {
        return "ORDER_" + System.currentTimeMillis();
    }
}
```

### æ”¯ä»˜å®æ”¯ä»˜é›†æˆ

#### ç¬¬ä¸€æ­¥ï¼šç”³è¯·æ”¯ä»˜å®å¼€æ”¾å¹³å°

1. è®¿é—® [æ”¯ä»˜å®å¼€æ”¾å¹³å°](https://open.alipay.com/)
2. åˆ›å»ºåº”ç”¨ï¼Œé€‰æ‹©"ç½‘é¡µ&ç§»åŠ¨åº”ç”¨"
3. è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š
   - `APPID`
   - `åº”ç”¨ç§é’¥`
   - `æ”¯ä»˜å®å…¬é’¥`

#### ç¬¬äºŒæ­¥ï¼šMavenä¾èµ–

```xml
<!-- æ”¯ä»˜å®SDK -->
<dependency>
    <groupId>com.alipay.sdk</groupId>
    <artifactId>alipay-sdk-java</artifactId>
    <version>4.39.0.ALL</version>
</dependency>
```

#### ç¬¬ä¸‰æ­¥ï¼šé…ç½®

åœ¨ `.env` ä¸­æ·»åŠ ï¼š

```bash
# æ”¯ä»˜å®æ”¯ä»˜é…ç½®
ALIPAY_APP_ID=your_app_id
ALIPAY_PRIVATE_KEY=your_private_key
ALIPAY_PUBLIC_KEY=alipay_public_key
ALIPAY_NOTIFY_URL=https://yourdomain.com/api/payment/alipay/notify
```

#### ç¬¬å››æ­¥ï¼šæ”¯ä»˜å®ç°

```java
/**
 * åˆ›å»ºæ”¯ä»˜å®æ”¯ä»˜è®¢å•ï¼ˆæ‰«ç æ”¯ä»˜ï¼‰
 */
@PostMapping("/alipay/create")
public ResponseEntity<?> createAlipayPayment(@RequestBody Map<String, Object> request) {
    try {
        AlipayClient alipayClient = new DefaultAlipayClient(
            "https://openapi.alipay.com/gateway.do",
            appId,
            privateKey,
            "json",
            "UTF-8",
            alipayPublicKey,
            "RSA2"
        );
        
        AlipayTradePrecreateRequest alipayRequest = new AlipayTradePrecreateRequest();
        alipayRequest.setNotifyUrl("https://yourdomain.com/api/payment/alipay/notify");
        
        JSONObject bizContent = new JSONObject();
        bizContent.put("out_trade_no", generateOrderNo());
        bizContent.put("total_amount", request.get("amount"));
        bizContent.put("subject", request.get("description"));
        
        alipayRequest.setBizContent(bizContent.toString());
        
        AlipayTradePrecreateResponse response = alipayClient.execute(alipayRequest);
        
        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("qrCode", response.getQrCode()); // äºŒç»´ç å†…å®¹
        
        return ResponseEntity.ok(result);
    } catch (Exception e) {
        log.error("åˆ›å»ºæ”¯ä»˜å®è®¢å•å¤±è´¥", e);
        return ResponseEntity.badRequest()
            .body(Map.of("success", false, "message", e.getMessage()));
    }
}

/**
 * æ”¯ä»˜å®æ”¯ä»˜å›è°ƒ
 */
@PostMapping("/alipay/notify")
public ResponseEntity<String> alipayNotify(@RequestParam Map<String, String> params) {
    try {
        // éªŒè¯ç­¾å
        boolean signVerified = AlipaySignature.rsaCheckV1(
            params, alipayPublicKey, "UTF-8", "RSA2");
        
        if (signVerified) {
            String tradeStatus = params.get("trade_status");
            
            if ("TRADE_SUCCESS".equals(tradeStatus)) {
                // TODO: å¤„ç†ä¸šåŠ¡é€»è¾‘
                log.info("æ”¯ä»˜æˆåŠŸï¼Œè®¢å•å·: {}", params.get("out_trade_no"));
            }
            
            return ResponseEntity.ok("success");
        } else {
            log.error("æ”¯ä»˜å®ç­¾åéªŒè¯å¤±è´¥");
            return ResponseEntity.badRequest().body("fail");
        }
    } catch (Exception e) {
        log.error("å¤„ç†æ”¯ä»˜å®å›è°ƒå¤±è´¥", e);
        return ResponseEntity.badRequest().body("fail");
    }
}
```

### æ”¯ä»˜åŠŸèƒ½è¯´æ˜

#### è´¹ç‡å¯¹æ¯”

| æ”¯ä»˜æ–¹å¼ | å®˜æ–¹è´¹ç‡ | èšåˆæ”¯ä»˜è´¹ç‡ | åˆ°è´¦å‘¨æœŸ |
|---------|---------|------------|---------|
| **å¾®ä¿¡æ”¯ä»˜** | 0.6% | 0.6% + 0.2% | T+1 |
| **æ”¯ä»˜å®** | 0.6% | 0.6% + 0.2% | T+1 |

> ğŸ’¡ å»ºè®®ï¼šç›´æ¥å¯¹æ¥å®˜æ–¹SDKï¼Œçœå»èšåˆæ”¯ä»˜çš„é¢å¤–è´¹ç”¨

#### æ”¯ä»˜æµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant å‰ç«¯
    participant åç«¯
    participant å¾®ä¿¡/æ”¯ä»˜å®

    ç”¨æˆ·->>å‰ç«¯: ç‚¹å‡»è´­ä¹°VIP
    å‰ç«¯->>åç«¯: POST /api/payment/wechat/create
    åç«¯->>å¾®ä¿¡/æ”¯ä»˜å®: åˆ›å»ºé¢„æ”¯ä»˜è®¢å•
    å¾®ä¿¡/æ”¯ä»˜å®-->>åç«¯: è¿”å›æ”¯ä»˜äºŒç»´ç 
    åç«¯-->>å‰ç«¯: è¿”å›äºŒç»´ç URL
    å‰ç«¯->>ç”¨æˆ·: å±•ç¤ºäºŒç»´ç 
    ç”¨æˆ·->>å¾®ä¿¡/æ”¯ä»˜å®: æ‰«ç æ”¯ä»˜
    å¾®ä¿¡/æ”¯ä»˜å®->>åç«¯: æ”¯ä»˜æˆåŠŸå›è°ƒ
    åç«¯->>åç«¯: æ›´æ–°è®¢å•çŠ¶æ€ï¼Œå¼€é€šä¼šå‘˜
    åç«¯-->>å¾®ä¿¡/æ”¯ä»˜å®: è¿”å›å¤„ç†æˆåŠŸ
    åç«¯->>å‰ç«¯: WebSocketæ¨é€æ”¯ä»˜æˆåŠŸ
    å‰ç«¯->>ç”¨æˆ·: æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸï¼Œè·³è½¬
```

---

## ğŸ—ºï¸ å®æ–½è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šèº«ä»½è®¤è¯ï¼ˆ1-3å¤©ï¼‰

**ä½¿ç”¨Authingæ–¹æ¡ˆ**ï¼š

- [x] **Day 1**: 
  - [ ] æ³¨å†ŒAuthingè´¦å·ï¼Œåˆ›å»ºç”¨æˆ·æ± 
  - [ ] é…ç½®å¾®ä¿¡ã€æ”¯ä»˜å®ç¤¾äº¤ç™»å½•
  - [ ] é…ç½®æ‰‹æœºå·ã€é‚®ç®±ç™»å½•æ–¹å¼
  - [ ] æ·»åŠ Mavenä¾èµ–

- [x] **Day 2**:
  - [ ] å®ç°åç«¯è®¤è¯APIï¼ˆ`AuthController.java`ï¼‰
  - [ ] é…ç½®Spring Security
  - [ ] å®ç°JWTè¿‡æ»¤å™¨
  - [ ] ä¸ºç°æœ‰APIæ·»åŠ æƒé™ä¿æŠ¤

- [x] **Day 3**:
  - [ ] å‰ç«¯é›†æˆAuthing SDK
  - [ ] å®ç°ç™»å½•/æ³¨å†Œé¡µé¢
  - [ ] å®ç°Tokenå­˜å‚¨å’Œè¯·æ±‚æ‹¦æˆª
  - [ ] æµ‹è¯•æ‰€æœ‰ç™»å½•æ–¹å¼

### é˜¶æ®µäºŒï¼šæ”¯ä»˜åŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰

- [x] **Day 4**:
  - [ ] ç”³è¯·å¾®ä¿¡æ”¯ä»˜å•†æˆ·å·
  - [ ] ç”³è¯·æ”¯ä»˜å®å•†æˆ·å·
  - [ ] æ·»åŠ æ”¯ä»˜SDKä¾èµ–
  - [ ] é…ç½®æ”¯ä»˜å¯†é’¥å’Œè¯ä¹¦

- [x] **Day 5**:
  - [ ] å®ç°æ”¯ä»˜è®¢å•åˆ›å»ºAPI
  - [ ] å®ç°æ”¯ä»˜å›è°ƒå¤„ç†
  - [ ] å®ç°è®¢å•çŠ¶æ€æŸ¥è¯¢
  - [ ] å‰ç«¯é›†æˆæ”¯ä»˜UI

- [x] **Day 6**:
  - [ ] æµ‹è¯•æ”¯ä»˜æµç¨‹
  - [ ] å®ç°ä¼šå‘˜æƒç›Šç®¡ç†
  - [ ] å®ç°æ”¯ä»˜æ—¥å¿—è®°å½•
  - [ ] å®‰å…¨æµ‹è¯•

### é˜¶æ®µä¸‰ï¼šä¼˜åŒ–ä¸ä¸Šçº¿ï¼ˆ1-2å¤©ï¼‰

- [x] **Day 7**:
  - [ ] å®‰å…¨åŠ å›ºï¼ˆHTTPSã€SQLæ³¨å…¥é˜²æŠ¤ã€XSSé˜²æŠ¤ï¼‰
  - [ ] æ€§èƒ½æµ‹è¯•
  - [ ] æ—¥å¿—ç›‘æ§é…ç½®
  - [ ] å‡†å¤‡ä¸Šçº¿æ–‡æ¡£

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. HTTPSåŠ å¯†

**å¿…é¡»ä½¿ç”¨HTTPS**ï¼Œæ‰€æœ‰æ•æ„Ÿæ•°æ®ä¼ è¾“éƒ½è¦åŠ å¯†ï¼š

```bash
# ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦
sudo certbot --nginx -d yourdomain.com
```

### 2. å¯†é’¥ç®¡ç†

**ä¸è¦æŠŠå¯†é’¥æäº¤åˆ°Git**ï¼š

```bash
# .gitignore
.env
src/main/resources/*.p12
src/main/resources/*.pem
```

### 3. SQLæ³¨å…¥é˜²æŠ¤

ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå¦‚æœæœªæ¥å¼•å…¥æ•°æ®åº“ï¼‰ï¼š

```java
// âœ… å®‰å…¨çš„æ–¹å¼
String sql = "SELECT * FROM users WHERE email = ?";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, email);

// âŒ å±é™©çš„æ–¹å¼
String sql = "SELECT * FROM users WHERE email = '" + email + "'";
```

### 4. XSSé˜²æŠ¤

Spring Booté»˜è®¤å·²å¼€å¯XSSé˜²æŠ¤ï¼Œç¡®ä¿ä¸ç¦ç”¨ï¼š

```java
// åœ¨è¿”å›HTMLæ—¶ï¼Œè‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
model.addAttribute("userName", userInput); // Springä¼šè‡ªåŠ¨è½¬ä¹‰
```

### 5. CORSé…ç½®

åªå…è®¸å¯ä¿¡åŸŸåè®¿é—®APIï¼š

```java
@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                    .allowedOrigins(
                        "http://localhost:3000",
                        "https://yourdomain.com"
                    )
                    .allowedMethods("GET", "POST", "PUT", "DELETE")
                    .allowCredentials(true);
            }
        };
    }
}
```

### 6. é€Ÿç‡é™åˆ¶

é˜²æ­¢æš´åŠ›ç ´è§£å’ŒDDoSæ”»å‡»ï¼š

```xml
<!-- Bucket4j é€Ÿç‡é™åˆ¶ -->
<dependency>
    <groupId>com.github.vladimir-bukhtoyarov</groupId>
    <artifactId>bucket4j-core</artifactId>
    <version>8.7.0</version>
</dependency>
```

```java
// é™åˆ¶ç™»å½•æ¥å£ï¼šæ¯åˆ†é’Ÿæœ€å¤š5æ¬¡
@RateLimiter(name = "login", fallbackMethod = "loginFallback")
@PostMapping("/api/auth/login")
public ResponseEntity<?> login(@RequestBody LoginRequest request) {
    // ...
}
```

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

### Authingæ–¹æ¡ˆæ€»æˆæœ¬

| é¡¹ç›® | è´¹ç”¨ | è¯´æ˜ |
|------|------|------|
| **Authingå…è´¹ç‰ˆ** | 0å…ƒ/æœˆ | 8000 MAUï¼Œè¶³å¤ŸåˆæœŸä½¿ç”¨ |
| **å¾®ä¿¡æ”¯ä»˜** | 0.6% äº¤æ˜“é¢ | å®˜æ–¹è´¹ç‡ |
| **æ”¯ä»˜å®** | 0.6% äº¤æ˜“é¢ | å®˜æ–¹è´¹ç‡ |
| **SSLè¯ä¹¦** | 0å…ƒ | Let's Encryptå…è´¹ |
| **æœåŠ¡å™¨** | çº¦100-300å…ƒ/æœˆ | é˜¿é‡Œäº‘/è…¾è®¯äº‘è½»é‡æœåŠ¡å™¨ |
| **çŸ­ä¿¡æœåŠ¡** | çº¦0.03-0.05å…ƒ/æ¡ | é˜¿é‡Œäº‘/è…¾è®¯äº‘SMS |
| **æ€»è®¡ï¼ˆåˆæœŸï¼‰** | **100-300å…ƒ/æœˆ** | ä¸å«äº¤æ˜“æ‰‹ç»­è´¹ |

### Keycloakè‡ªå»ºæ–¹æ¡ˆæ€»æˆæœ¬

| é¡¹ç›® | è´¹ç”¨ | è¯´æ˜ |
|------|------|------|
| **Keycloak** | 0å…ƒ | å¼€æºå…è´¹ |
| **æœåŠ¡å™¨** | çº¦200-500å…ƒ/æœˆ | éœ€è¦æ›´é«˜é…ç½® |
| **PostgreSQL** | 0å…ƒ | å¼€æºå…è´¹ |
| **è¿ç»´äººåŠ›** | è§†æƒ…å†µ | éœ€è¦ä¸“äººç»´æŠ¤ |
| **å¾®ä¿¡æ”¯ä»˜** | 0.6% äº¤æ˜“é¢ | å®˜æ–¹è´¹ç‡ |
| **æ”¯ä»˜å®** | 0.6% äº¤æ˜“é¢ | å®˜æ–¹è´¹ç‡ |
| **æ€»è®¡ï¼ˆåˆæœŸï¼‰** | **200-500å…ƒ/æœˆ** | ä¸å«äººåŠ›æˆæœ¬ |

---

## ğŸ¬ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èæµç¨‹ï¼‰

### æ–¹æ¡ˆé€‰æ‹©å»ºè®®

æ ¹æ®ä½ çš„é¡¹ç›®æƒ…å†µï¼Œæˆ‘å¼ºçƒˆæ¨èï¼š

> **èº«ä»½è®¤è¯ï¼šAuthing**  
> **æ”¯ä»˜ï¼šå¾®ä¿¡æ”¯ä»˜ + æ”¯ä»˜å®ï¼ˆå®˜æ–¹SDKï¼‰**

**ç†ç”±**ï¼š
1. â±ï¸ **æœ€å¿«ä¸Šçº¿**ï¼š3å¤©å†…å®Œæˆé›†æˆ
2. ğŸ’° **æˆæœ¬æœ€ä½**ï¼šå…è´¹ç‰ˆè¶³å¤Ÿä½¿ç”¨
3. ğŸ›¡ï¸ **å®‰å…¨å¯é **ï¼šä¸“ä¸šå›¢é˜Ÿç»´æŠ¤ï¼Œç¬¦åˆç­‰ä¿è¦æ±‚
4. ğŸš€ **æ— éœ€è¿ç»´**ï¼šäº‘æœåŠ¡ï¼Œè‡ªåŠ¨æ‰©å®¹
5. ğŸ“± **ç”¨æˆ·ä½“éªŒå¥½**ï¼šç°æˆçš„ç™»å½•UIï¼Œæ”¯æŒæ‰€æœ‰ä¸»æµç™»å½•æ–¹å¼

### ç«‹å³å¼€å§‹

```bash
# 1. æ³¨å†ŒAuthingè´¦å·
æ‰“å¼€æµè§ˆå™¨è®¿é—®: https://authing.cn/

# 2. æ·»åŠ ä¾èµ–åˆ°é¡¹ç›®
cd /Users/user/autoresume/get_jobs
# ç¼–è¾‘ pom.xmlï¼Œæ·»åŠ Authingå’ŒJWTä¾èµ–

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp src/main/resources/.env src/main/resources/.env.backup
# ç¼–è¾‘ .envï¼Œæ·»åŠ Authingé…ç½®

# 4. åˆ›å»ºè®¤è¯ç›¸å…³ä»£ç 
# æŒ‰ç…§æœ¬æ–‡æ¡£çš„ä»£ç ç¤ºä¾‹åˆ›å»ºç›¸åº”çš„Javaç±»

# 5. å‰ç«¯é›†æˆ
cd /Users/user/autoresume/zhitoujianli-website
npm install @authing/web
# åˆ›å»ºLoginç»„ä»¶
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- **Authingæ–‡æ¡£**: https://docs.authing.cn/
- **Authing Java SDK**: https://docs.authing.cn/v2/reference/sdk-for-java/
- **å¾®ä¿¡æ”¯ä»˜æ–‡æ¡£**: https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml
- **æ”¯ä»˜å®å¼€æ”¾å¹³å°**: https://opendocs.alipay.com/
- **Keycloakæ–‡æ¡£**: https://www.keycloak.org/documentation

### ç¤ºä¾‹é¡¹ç›®

- Authing + Spring Bootç¤ºä¾‹: https://github.com/Authing/authing-java-sdk-demo
- Keycloak + Spring Bootç¤ºä¾‹: https://github.com/keycloak/keycloak-quickstarts

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸æ¨èè‡ªå·±å¼€å‘ç™»å½•ç³»ç»Ÿï¼Ÿ

**A**: èº«ä»½è®¤è¯æ˜¯å®‰å…¨çš„é‡ç¾åŒºï¼Œè‡ªå·±å¼€å‘å®¹æ˜“å‡ºç°ï¼š
- å¯†ç å­˜å‚¨ä¸å®‰å…¨ï¼ˆæ˜æ–‡æˆ–å¼±åŠ å¯†ï¼‰
- SQLæ³¨å…¥æ¼æ´
- ä¼šè¯åŠ«æŒé£é™©
- ç¼ºå°‘MFAç­‰é«˜çº§å®‰å…¨åŠŸèƒ½
- ç¤¾äº¤ç™»å½•å¯¹æ¥å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

ä½¿ç”¨æˆç†Ÿæ–¹æ¡ˆï¼Œå®‰å…¨æ€§ç”±ä¸“ä¸šå›¢é˜Ÿä¿éšœã€‚

### Q2: Authingå’ŒKeycloakæ€ä¹ˆé€‰ï¼Ÿ

**é€‰Authingçš„åœºæ™¯**ï¼š
- âœ… å¿«é€Ÿä¸Šçº¿ï¼ˆ1-3å¤©ï¼‰
- âœ… å°å›¢é˜Ÿï¼Œæ— ä¸“èŒè¿ç»´
- âœ… éœ€è¦å›½å†…ç¤¾äº¤ç™»å½•ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ï¼‰
- âœ… å…è´¹é¢åº¦è¶³å¤Ÿä½¿ç”¨

**é€‰Keycloakçš„åœºæ™¯**ï¼š
- âœ… éœ€è¦å®Œå…¨è‡ªä¸»æ§åˆ¶æ•°æ®
- âœ… æœ‰ä¸“ä¸šè¿ç»´å›¢é˜Ÿ
- âœ… ç”¨æˆ·é‡å·¨å¤§ï¼Œæˆæœ¬æ•æ„Ÿ
- âœ… éœ€è¦æ·±åº¦å®šåˆ¶

### Q3: å¦‚ä½•è¿ç§»ç°æœ‰ç”¨æˆ·æ•°æ®ï¼Ÿ

å¦‚æœå°†æ¥æœ‰ç°æœ‰ç”¨æˆ·ï¼ŒAuthingæä¾›ç”¨æˆ·å¯¼å…¥APIï¼š
```java
ManagementClient client = new ManagementClient(userPoolId, secret);
CreateUserReqDto dto = new CreateUserReqDto();
dto.setEmail("user@example.com");
dto.setPhone("+86 188xxxx8888");
UserSingleRespDto user = client.createUser(dto);
```

### Q4: æ”¯ä»˜åŠŸèƒ½å¦‚ä½•æµ‹è¯•ï¼Ÿ

- **å¾®ä¿¡æ”¯ä»˜**ï¼šä½¿ç”¨æ²™ç®±ç¯å¢ƒ https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_1
- **æ”¯ä»˜å®**ï¼šä½¿ç”¨æ²™ç®±ç¯å¢ƒ https://openhome.alipay.com/platform/appDaily.htm

### Q5: éœ€è¦ä»€ä¹ˆèµ„è´¨æ‰èƒ½æ¥å…¥æ”¯ä»˜ï¼Ÿ

- **ä¸ªäººå¼€å‘è€…**ï¼šåªèƒ½ä½¿ç”¨å½“é¢ä»˜ï¼ˆæ”¶æ¬¾ç ï¼‰
- **ä¼ä¸š/ä¸ªä½“æˆ·**ï¼šéœ€è¦è¥ä¸šæ‰§ç…§ï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´æ”¯ä»˜åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åšçš„äº‹æƒ…ï¼ˆæ— éœ€ç­‰å¾…å®¡æ‰¹ï¼‰

1. **æ³¨å†ŒAuthingè´¦å·**ï¼ˆ5åˆ†é’Ÿï¼‰
   - è®¿é—® https://authing.cn/
   - åˆ›å»ºç”¨æˆ·æ± ï¼Œé…ç½®ç™»å½•æ–¹å¼

2. **é›†æˆAuthing SDK**ï¼ˆ30åˆ†é’Ÿï¼‰
   - æ·»åŠ Mavenä¾èµ–
   - é…ç½®ç¯å¢ƒå˜é‡
   - åˆ›å»ºAuthController

3. **ä¿æŠ¤ç°æœ‰API**ï¼ˆ1å°æ—¶ï¼‰
   - é…ç½®Spring Security
   - æ·»åŠ JWTè¿‡æ»¤å™¨
   - æµ‹è¯•APIæƒé™

### éœ€è¦ç”³è¯·èµ„è´¨çš„äº‹æƒ…

1. **ç”³è¯·å¾®ä¿¡æ”¯ä»˜**ï¼ˆ3-7å·¥ä½œæ—¥ï¼‰
   - éœ€è¦è¥ä¸šæ‰§ç…§
   - è®¿é—® https://pay.weixin.qq.com/

2. **ç”³è¯·æ”¯ä»˜å®æ”¯ä»˜**ï¼ˆ1-3å·¥ä½œæ—¥ï¼‰
   - éœ€è¦è¥ä¸šæ‰§ç…§
   - è®¿é—® https://open.alipay.com/

---

## ğŸ’¡ æœ€ç»ˆå»ºè®®

åŸºäºä½ çš„é¡¹ç›®ç‰¹ç‚¹ï¼ˆæ™ºèƒ½æ±‚èŒæŠ•é€’å¹³å°ï¼‰ï¼Œæˆ‘çš„æœ€ç»ˆå»ºè®®æ˜¯ï¼š

### ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼Œ1å‘¨å†…ä¸Šçº¿ï¼‰
```
âœ… ä½¿ç”¨Authingå¿«é€Ÿé›†æˆç™»å½•åŠŸèƒ½
âœ… æ”¯æŒæ‰‹æœºå·ã€é‚®ç®±ç™»å½•ï¼ˆæœ€åŸºç¡€ï¼‰
âœ… ä¿æŠ¤æ‰€æœ‰åå°ç®¡ç†API
âœ… æš‚ä¸é›†æˆæ”¯ä»˜ï¼Œå…ˆéªŒè¯äº§å“éœ€æ±‚
```

### ç¬¬äºŒé˜¶æ®µï¼ˆæ­£å¼å•†ä¸šåŒ–ï¼Œ2-4å‘¨ï¼‰
```
âœ… æ·»åŠ å¾®ä¿¡ã€æ”¯ä»˜å®ç¤¾äº¤ç™»å½•
âœ… é›†æˆå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜
âœ… å®ç°VIPä¼šå‘˜ä½“ç³»
âœ… æ·»åŠ MFAå¤šå› ç´ è®¤è¯
```

### ç¬¬ä¸‰é˜¶æ®µï¼ˆè§„æ¨¡åŒ–ï¼Œ2-3æœˆï¼‰
```
âœ… æ ¹æ®ç”¨æˆ·é‡å†³å®šæ˜¯å¦è¿ç§»åˆ°Keycloakè‡ªå»º
âœ… å®ç°æ›´å¤æ‚çš„æƒé™ç®¡ç†
âœ… æ·»åŠ ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ç™»å½•
âœ… å®Œå–„æ”¯ä»˜ç³»ç»Ÿï¼ˆé€€æ¬¾ã€å‘ç¥¨ç­‰ï¼‰
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨å®æ–½è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **AuthingæŠ€æœ¯æ”¯æŒ**ï¼š
   - å®˜æ–¹æ–‡æ¡£: https://docs.authing.cn/
   - ç¤¾åŒºè®ºå›: https://forum.authing.cn/
   - å¾®ä¿¡ç¾¤: å…³æ³¨å…¬ä¼—å·"Authing"è·å–

2. **å¾®ä¿¡æ”¯ä»˜æŠ€æœ¯æ”¯æŒ**ï¼š
   - å¼€å‘æ–‡æ¡£: https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml
   - å•†æˆ·å¹³å°: https://pay.weixin.qq.com/

3. **æ”¯ä»˜å®æŠ€æœ¯æ”¯æŒ**ï¼š
   - å¼€å‘è€…ä¸­å¿ƒ: https://opendocs.alipay.com/
   - å¼€æ”¾å¹³å°: https://open.alipay.com/

---

## âš ï¸ é‡è¦æé†’

1. **æ•°æ®åˆè§„**ï¼šæ”¶é›†ç”¨æˆ·ä¿¡æ¯éœ€è¦éµå®ˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ï¼Œå¿…é¡»ï¼š
   - æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ”¶é›†å“ªäº›ä¿¡æ¯
   - è·å¾—ç”¨æˆ·æ˜ç¡®åŒæ„
   - æä¾›éšç§æ”¿ç­–å’Œç”¨æˆ·åè®®

2. **æ”¯ä»˜èµ„è´¨**ï¼š
   - ä¸ªäººé¡¹ç›®åªèƒ½ä½¿ç”¨æ”¶æ¬¾ç 
   - å•†ä¸šåŒ–å¿…é¡»æœ‰è¥ä¸šæ‰§ç…§
   - éµå®ˆåæ´—é’±è§„å®š

3. **å®‰å…¨åŠ å›º**ï¼š
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
   - å®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬
   - é…ç½®æ—¥å¿—å®¡è®¡

---

**ç¥ä½ å¿«é€Ÿä¸Šçº¿ï¼Œé¡¹ç›®æˆåŠŸï¼ğŸ‰**

å¦‚æœ‰ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶äº¤æµè®¨è®ºã€‚
